<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        CrackMe 160 WP集合 - 一筐萝卜
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> 你若盛开，清风自来！ </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>一筐萝卜</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#001"><span class="toc-text">001</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#寻找生成Serial的关键代码"><span class="toc-text">寻找生成Serial的关键代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据上面的算法写出来注册机算法："><span class="toc-text">根据上面的算法写出来注册机算法：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#接着来看另一个Serial选项"><span class="toc-text">接着来看另一个Serial选项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#002"><span class="toc-text">002</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#寻找生成正确密码的关键代码"><span class="toc-text">寻找生成正确密码的关键代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据上面的算法写出来注册机算法：-1"><span class="toc-text">根据上面的算法写出来注册机算法：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#003"><span class="toc-text">003</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#寻找生成正确密码的关键代码-1"><span class="toc-text">寻找生成正确密码的关键代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据上面的算法写出来注册机算法：-2"><span class="toc-text">根据上面的算法写出来注册机算法：</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> 你若盛开，清风自来！ </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        CrackMe 160 WP集合
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2019-03-09 20:33:28</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#逆向" title="逆向">逆向</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <p>001~003</p>
<a id="more"></a>
<h3 id="001"><a href="#001" class="headerlink" title="001"></a>001</h3><p>PEID查壳发现是Borland Delphi     3.0，查了一波资料，这个是一中编程语言，并不是一种壳<br><img src="https://s2.ax1x.com/2019/03/09/ApABgH.jpg" alt><br>试着运行该程序，有三个选项，serial/Name、exit、Serial</p>
<p>选择serial/Name，要求输入name和serial，那么我们先随便输入两个，然后点击Check it Baby!，弹出了一个提示框</p>
<p>我们将程序载入OD中，在点击过Check it Baby!后在OD中f12暂停程序，alt+K 调出堆栈窗口，发现有两个关于MessageBoxA的函数调用，第一个地址不在该模块的领空，第二个实在0x42A1AE，可能是第二个吧。<br><img src="https://s2.ax1x.com/2019/03/09/ApADvd.jpg" alt> </p>
<p>右键-&gt;显示函数，就来到了调用该函数的地方，在函数的开始push ebp 下一个断点，在函数的最后ret也下一个断点<br><img src="https://s2.ax1x.com/2019/03/09/ApAXPU.jpg" alt> </p>
<p>继续运行程序，到ret处停之后f8/f7单步返回到调用处，可以看到附近的代码是关键代码了，0x42fb03处的jnz判断是serial正确错误的关键，控制jnz的就是临近它上面的函数<br><img src="https://s2.ax1x.com/2019/03/09/ApAjGF.jpg" alt><br>0x42fafe下断点，继续运行该程序，当程序在这个地址停止的时候发现edx中存着我们输入的Serial，eax中存着一个字符串，像是一个正确的Serial，那么将这个字符串输入到Serial当中，弹出来Good job dude！说明这个字符串就是一个正确的Serial</p>
<p><img src="https://s2.ax1x.com/2019/03/09/ApAv24.jpg" alt> </p>
<p>如果我们把关键jnz改成jmp的话，那么我们Serial输入什么都会提示正确，但是我们的目标并不是这个。</p>
<h4 id="寻找生成Serial的关键代码"><a href="#寻找生成Serial的关键代码" class="headerlink" title="寻找生成Serial的关键代码"></a>寻找生成Serial的关键代码</h4><p>由上面可知，在程序调用0x4039fc函数的时候，Serial已经是生成的了，所以关键代码应该实在上面<br><img src="https://s2.ax1x.com/2019/03/09/ApAxxJ.jpg" alt><br>进过对上面的代码分析得出，程序先取出我们输入的第一位，然后乘以0x29再乘以2，再转换成10进制，与程序中的两个字符串进行拼接，得出最后的Serial</p>
<h4 id="根据上面的算法写出来注册机算法："><a href="#根据上面的算法写出来注册机算法：" class="headerlink" title="根据上面的算法写出来注册机算法："></a>根据上面的算法写出来注册机算法：</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username = raw_input(<span class="string">"input username:"</span>)</span><br><span class="line">current = ord(username[0])*0x29*2</span><br><span class="line">print <span class="string">"your serial: "</span>+<span class="string">"CW-%d-CRACKED"</span> % (current)</span><br></pre></td></tr></table></figure>

<h4 id="接着来看另一个Serial选项"><a href="#接着来看另一个Serial选项" class="headerlink" title="接着来看另一个Serial选项"></a>接着来看另一个Serial选项</h4><p>直接输入一个字符串，然后验证，用刚刚的方法找到关键代码<br><img src="https://s2.ax1x.com/2019/03/09/ApEprR.jpg" alt><br>没有算法，直接是和两个拼接在一起的字符串进行比较，该字符串是“Hello Dude!”，验证一下：<br><img src="https://s2.ax1x.com/2019/03/09/ApE9q1.jpg" alt> </p>
<h3 id="002"><a href="#002" class="headerlink" title="002"></a>002</h3><p>同样是一个类型的题目，PEID查壳发现无壳，但是载入IDA中发现不能被解析，只好动态调试了</p>
<p>程序流程很简单，输入一个用户名、密码，来判断正确，按照做001的操作先在弹窗的时候暂停程序，看一下堆栈窗口，发现就一个函数调用是从模块中调用的<br><img src="https://s2.ax1x.com/2019/03/09/ApEia6.jpg" alt><br>跟踪一下发现来到了关键代码处，看到了不远处有跳向正确和错误输出的判断<br><img src="https://s2.ax1x.com/2019/03/09/ApEAPO.png" alt><br>如果把这个关键跳转给nop掉，那么无论输入什么都会成功</p>
<h4 id="寻找生成正确密码的关键代码"><a href="#寻找生成正确密码的关键代码" class="headerlink" title="寻找生成正确密码的关键代码"></a>寻找生成正确密码的关键代码</h4><p>在本函数的开头“push ebp”下断点，然后找到调用我们输入的字符串的代码，经过调试发现，在0x40240f引用了我们输入的字符串：</p>
<p><img src="https://s2.ax1x.com/2019/03/09/ApEZxH.jpg" alt> </p>
<p>首先是调用了lenBstr求出我们输入的字符串的长度，然后长度乘以0x17cfb，然后再乘以我们输入的字符串的第一个字符的ascii码，最后和字符串“AKA-”拼接起来就是密码了</p>
<p><img src="https://s2.ax1x.com/2019/03/09/ApEnsA.jpg" alt> </p>
<h4 id="根据上面的算法写出来注册机算法：-1"><a href="#根据上面的算法写出来注册机算法：-1" class="headerlink" title="根据上面的算法写出来注册机算法："></a>根据上面的算法写出来注册机算法：</h4><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username = raw_input(<span class="string">"input username:"</span>)</span><br><span class="line"><span class="keyword">length</span> = len(username)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"your password is : %s"</span> %(<span class="string">"AKA-"</span>+str(<span class="keyword">length</span>*<span class="number">0x17cfb</span>+<span class="keyword">ord</span>(username[<span class="number">0</span>])))</span><br></pre></td></tr></table></figure>

<h3 id="003"><a href="#003" class="headerlink" title="003"></a>003</h3><p>PEID查壳发现没加壳，试着运行一下，同样也是验证输出的username和password，根据之前的操作：输入之后点击check，出现弹窗之后在OD中暂停程序，然后看函数调用：<br><img src="https://s2.ax1x.com/2019/03/10/Apqjbj.jpg" alt><br>也就最后一个最显眼，那么右键查看显示调用，就来到了调用的地方，向上分析看到了“you GET it！”和“you get wrong”，说明这个就是关键代码<br><img src="https://s2.ax1x.com/2019/03/10/Apqzan.jpg" alt><br>如果我们把0x408677地址上的je给nop掉，那么我们无论输出什么都可以输出成功</p>
<h4 id="寻找生成正确密码的关键代码-1"><a href="#寻找生成正确密码的关键代码-1" class="headerlink" title="寻找生成正确密码的关键代码"></a>寻找生成正确密码的关键代码</h4><p>同样是寻找本函数的函数头部，这个函数有点长，函数头在0x4080f0处，下断点重新运行程序，输出username和password，点击check<br><img src="https://s2.ax1x.com/2019/03/10/ApLS5q.png" alt><br>这个f8单步调试找到调用我们输入字符串的关键代码：</p>
<p>在0x4081ef处第一次调用我们输入的username</p>
<ul>
<li>首先求出username的长度</li>
<li>长度乘以0x15b38</li>
<li>再加上username第一个字符的ascii码</li>
<li>转换成十进制字符串</li>
<li>调用vbaR8Str 将十进制字符串转换成双精度浮点型的数值类型</li>
<li>fld将浮点数10.00000压入到ST寄存器中</li>
<li>fdiv 是将ST0除以值结果存在ST0中</li>
<li>faddp 将ST1+ST0 放在ST1中，弹出寄存器</li>
<li>fstp类似于pop，把值从ST寄存器中转移到栈上</li>
<li>vbaStrR8 是把双精度浮点数转换成字符串类型</li>
<li>vbaStrMove是把edx的复制到指定的栈上</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/03/10/ApLCGV.png" alt> </p>
<ul>
<li>vbaFreeStrList 是将在栈上的变量给释放掉，用0替代</li>
<li>fmul 是ST0×值存到ST0中</li>
<li>fsub 是ST0-值存到ST0中</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/03/10/ApLP2T.png" alt> </p>
<ul>
<li>fsub是ST0-值存到ST0中，这里是减去一个负数，那么就是加上它的绝对值<br><img src="https://s2.ax1x.com/2019/03/10/ApLkMF.png" alt> </li>
<li>然后就是第一次调用我们输入的password</li>
<li>先是将password转成了双精度浮点型</li>
<li>然后和刚刚一系列运算得出的结果相除</li>
<li>除运算的结果和1进行比较</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/03/10/ApLAr4.png" alt> </p>
<h4 id="根据上面的算法写出来注册机算法：-2"><a href="#根据上面的算法写出来注册机算法：-2" class="headerlink" title="根据上面的算法写出来注册机算法："></a>根据上面的算法写出来注册机算法：</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username = raw_input(<span class="string">"input username:"</span>)</span><br><span class="line">length = len(username)</span><br><span class="line">print <span class="string">"your password is : %d"</span> %((length*<span class="number">0x15b38</span>+ord(username[<span class="number">0</span>])+<span class="number">2</span>)*<span class="number">3</span><span class="number">-2</span>-(<span class="number">-15</span>))</span><br></pre></td></tr></table></figure>
        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        转发请备注<a href=“https://luobuming.github.io”>一筐萝卜</a>的个人博客 <br>
        本站总访问量<span id="busuanzi_value_site_pv"></span>次
       </p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
